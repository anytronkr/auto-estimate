<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipedrive ê±°ë˜ ìƒì„± í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f8f8f8;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1cc7b6;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background: #1cc7b6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #189a8c;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Pipedrive ê±°ë˜ ìƒì„± í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>1. ê¸°ë³¸ í…ŒìŠ¤íŠ¸</h3>
            <p>ì´í›ˆìˆ˜ ë‹´ë‹¹ìë¡œ í…ŒìŠ¤íŠ¸ ê±°ë˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
            <button onclick="testBasicDeal()">ê¸°ë³¸ ê±°ë˜ ìƒì„± í…ŒìŠ¤íŠ¸</button>
            <div id="basic-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. ì‹¤ì œ ê²¬ì ì„œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸</h3>
            <p>ì‹¤ì œ ê²¬ì ì„œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê±°ë˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
            <button onclick="testRealDeal()">ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
            <div id="real-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. ì„¤ì • í™•ì¸</h3>
            <p>í˜„ì¬ Pipedrive ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="checkConfig()">ì„¤ì • í™•ì¸</button>
            <div id="config-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. íŒŒì´í”„ë¼ì¸ ëª©ë¡ í™•ì¸</h3>
            <p>ì‚¬ìš© ê°€ëŠ¥í•œ Pipedrive íŒŒì´í”„ë¼ì¸ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="checkPipelines()">íŒŒì´í”„ë¼ì¸ ëª©ë¡ í™•ì¸</button>
            <div id="pipelines-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>5. íŒŒì´í”„ë¼ì¸ 4 ìŠ¤í…Œì´ì§€ í™•ì¸</h3>
            <p>ê²¬ì ì„œìƒì„± íŒŒì´í”„ë¼ì¸(4)ì˜ ìŠ¤í…Œì´ì§€ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="checkStages(4)">ìŠ¤í…Œì´ì§€ ëª©ë¡ í™•ì¸</button>
            <div id="stages-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        async function testBasicDeal() {
            const resultDiv = document.getElementById('basic-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                const response = await fetch('http://localhost:9000/test-pipedrive', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ì„±ê³µ!\n\n${result.message}\n\nê±°ë˜ ID: ${result.deal_id}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ì‹¤íŒ¨!\n\n${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\n${error.message}`;
            }
        }

        async function testRealDeal() {
            const resultDiv = document.getElementById('real-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                // ì‹¤ì œ ê²¬ì ì„œ ë°ì´í„°
                const realData = {
                    estimate_date: "2025-01-20",
                    estimate_number: "DLP250120-1",
                    supplier_person: "ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì´í›ˆìˆ˜ ì´ì‚¬",
                    supplier_contact: "hslee@bitekps.com / 010-3252-0593",
                    receiver_company: "í…ŒìŠ¤íŠ¸ê¸°ì—…(ì£¼)",
                    receiver_person: "ê¹€í…ŒìŠ¤íŠ¸",
                    receiver_contact: "test@company.com",
                    delivery_date: "ì…ê¸ˆí™•ì¸ì¼ë¡œë¶€í„° 2ì£¼ ì´ë‚´",
                    product_category: "ì¥ë¹„",
                    products: [
                        {
                            type: "ì»¬ëŸ¬ë¼ë²¨í”„ë¦°í„°",
                            name: "1050 5ìƒ‰",
                            detail: "ì‚°ì—…ìš© ë ˆì´ì € ì»¬ëŸ¬ë¼ë²¨í”„ë¦°í„° CMYKW 5ìƒ‰",
                            qty: 1,
                            price: 12000000,
                            total: 12000000,
                            note: "í…ŒìŠ¤íŠ¸"
                        }
                    ]
                };

                const response = await fetch('http://localhost:9000/collect-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(realData)
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ì„±ê³µ!\n\n${result.message}\n\nPipedrive ê±°ë˜ ID: ${result.pipedrive_deal_id || 'ìƒì„±ë˜ì§€ ì•ŠìŒ'}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ì‹¤íŒ¨!\n\n${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\n${error.message}`;
            }
        }

        async function checkConfig() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ì„¤ì • í™•ì¸ ì¤‘...';

            try {
                const response = await fetch('http://localhost:9000/pipedrive-config', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const config = await response.json();
                
                let configText = `ğŸ“‹ í˜„ì¬ ì„¤ì • í™•ì¸\n\n`;
                configText += `âœ… API í† í°: ${config.api_token}\n`;
                configText += `âœ… ë„ë©”ì¸: ${config.domain}\n`;
                configText += `âœ… íŒŒì´í”„ë¼ì¸ ID: ${config.pipeline_id}\n`;
                configText += `âœ… ìŠ¤í…Œì´ì§€ ID: ${config.stage_id}\n\n`;
                
                configText += `âœ… Pipedrive ì‚¬ìš©ì ë§¤í•‘:\n`;
                for (const [name, id] of Object.entries(config.user_mapping)) {
                    configText += `- ${name} â†’ ì‚¬ìš©ì ID ${id}\n`;
                }
                
                configText += `\nâœ… ì„¤ì • íŒŒì¼ ìƒíƒœ: pipedrive_config_local.py ë¡œë“œë¨`;
                
                resultDiv.className = 'result success';
                resultDiv.textContent = configText;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì„¤ì • í™•ì¸ ì‹¤íŒ¨!\n\n${error.message}`;
            }
        }

        async function checkPipelines() {
            const resultDiv = document.getElementById('pipelines-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'íŒŒì´í”„ë¼ì¸ ëª©ë¡ í™•ì¸ ì¤‘...';

            try {
                const response = await fetch('http://localhost:9000/pipedrive-pipelines', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    let pipelinesText = `ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ íŒŒì´í”„ë¼ì¸ ëª©ë¡\n\n`;
                    
                    for (const pipeline of result.pipelines) {
                        const status = pipeline.active ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±';
                        pipelinesText += `${status} ID: ${pipeline.id} - ${pipeline.name}\n`;
                    }
                    
                    resultDiv.className = 'result success';
                    resultDiv.textContent = pipelinesText;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ íŒŒì´í”„ë¼ì¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨!\n\n${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ íŒŒì´í”„ë¼ì¸ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜!\n\n${error.message}`;
            }
        }

        async function checkStages(pipelineId) {
            const resultDiv = document.getElementById('stages-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ìŠ¤í…Œì´ì§€ ëª©ë¡ í™•ì¸ ì¤‘...';

            try {
                const response = await fetch(`http://localhost:9000/pipedrive-stages/${pipelineId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    let stagesText = `ğŸ“‹ íŒŒì´í”„ë¼ì¸ ${pipelineId} ìŠ¤í…Œì´ì§€ ëª©ë¡\n\n`;
                    
                    for (const stage of result.stages) {
                        const status = stage.active ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±';
                        stagesText += `${status} ID: ${stage.id} - ${stage.name} (ìˆœì„œ: ${stage.order_nr})\n`;
                    }
                    
                    resultDiv.className = 'result success';
                    resultDiv.textContent = stagesText;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ìŠ¤í…Œì´ì§€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨!\n\n${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ìŠ¤í…Œì´ì§€ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜!\n\n${error.message}`;
            }
        }
    </script>
</body>
</html> 