<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²¬ì ë‚´ìš© ì…ë ¥</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(42, 132, 134, 0.15);
      overflow: hidden;
    }

    .header {
      background: #2A8486;
      color: white;
      padding: 30px 40px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .content {
      padding: 40px;
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #2A8486;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #2A8486;
      display: flex;
      align-items: center;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: #2A8486;
      margin-right: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    label .required {
      color: #e74c3c;
      margin-left: 4px;
    }

    input[type="text"],
    input[type="date"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea {
      padding: 12px 16px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
      font-family: inherit;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #2A8486;
      box-shadow: 0 0 0 3px rgba(42, 132, 134, 0.1);
    }

    input[readonly] {
      background: #f8f9fa;
      cursor: not-allowed;
    }

    select {
      cursor: pointer;
      appearance: none;
      background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E") no-repeat right 12px center;
      padding-right: 40px;
    }

    hr {
      border: none;
      border-top: 1px solid #e9ecef;
      margin: 24px 0;
    }

    .product-set {
      background: #f8f9fa;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
      position: relative;
    }

    .product-set:hover {
      border-color: #2A8486;
    }

    .product-set > div:first-child {
      font-size: 16px;
      font-weight: 600;
      color: #2A8486;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .remove-btn {
      background: white;
      color: #e74c3c;
      border: 1px solid #e74c3c;
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .remove-btn:hover {
      background: #e74c3c;
      color: white;
    }

    .move-btn {
      background: white;
      color: #2A8486;
      border: 1px solid #2A8486;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 30px;
    }

    .move-btn:hover {
      background: #2A8486;
      color: white;
    }

    .move-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .product-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .product-row input, .product-row select {
      flex: 1;
      margin-top: 0;
    }

    .product-field-label {
      font-size: 13px;
      font-weight: 500;
      color: #555;
      margin-bottom: 6px;
      display: block;
    }

    .product-field-group {
      margin-bottom: 12px;
    }

    .product-field-group.three-columns {
      display: grid;
      grid-template-columns: 1fr 1fr 1.2fr;
      gap: 12px;
    }

    .product-field-group.three-columns > div {
      display: flex;
      flex-direction: column;
    }

    .product-total-highlight {
      background: #e8f5f5 !important;
      border: 2px solid #2A8486 !important;
      font-weight: 600;
      color: #2A8486;
    }

    .required-notice {
      background: #fff9e6;
      border-left: 4px solid #ffc107;
      padding: 12px 16px;
      margin-bottom: 24px;
      font-size: 13px;
      color: #666;
      border-radius: 4px;
    }

    .add-btn {
      background: #2A8486;
      color: white;
      padding: 8px 16px;
      font-size: 13px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .add-btn:hover {
      background: #236b6d;
    }

    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: #2A8486;
      color: white;
    }

    .btn-primary:hover {
      background: #236b6d;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(42, 132, 134, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #2A8486;
      border: 1px solid #2A8486;
    }

    .btn-secondary:hover {
      background: #f8f9fa;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #e9ecef;
    }

    .info-badge {
      display: inline-block;
      background: #e8f5f5;
      color: #2A8486;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 8px;
    }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ */
    .loading {
      position: relative;
      background: #2A8486 !important;
      color: transparent !important;
      pointer-events: none;
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(42, 132, 134, 0.3);
      transition: all 0.3s ease;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 24px;
      height: 24px;
      margin: -12px 0 0 -12px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 10;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ë²„íŠ¼ ë¹„í™œì„±í™” ìƒíƒœ */
    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    textarea {
      resize: vertical;
      min-height: 150px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .content {
        padding: 20px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .product-set > div:first-child {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .product-row {
        flex-direction: column;
        gap: 8px;
      }

      .product-field-group.three-columns {
        grid-template-columns: 1fr;
      }
    }

    /* 2-column ë ˆì´ì•„ì›ƒ (ë°ìŠ¤í¬í†± 1024px ì´ìƒ) */
    @media (min-width: 1024px) {
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .form-grid > div {
        margin-bottom: 0 !important;
      }

      .full-width {
        grid-column: 1 / -1;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ“‹ ê²¬ì ë‚´ìš© ì…ë ¥</h1>
    <p>(ì£¼)ë°”ì´í…í…Œí¬ë†€ë¡œì§€</p>
  </div>

  <div class="content">
    <!-- í•„ìˆ˜ ì…ë ¥ ì•ˆë‚´ -->
    <div class="required-notice">
      <strong>*</strong> í‘œì‹œëŠ” í•„ìˆ˜ì‚¬í•­ì…ë‹ˆë‹¤. <strong>*</strong> í‘œì‹œê°€ ì—†ëŠ” í•­ëª©ì€ ì…ë ¥í•˜ì§€ ì•Šìœ¼ì…”ë„ ë©ë‹ˆë‹¤.
    </div>

    <!-- ê¸°ë³¸ì •ë³´ -->
    <div class="section">
      <h2 class="section-title">ê¸°ë³¸ì •ë³´</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ê²¬ì ì¼ì <span class="required">*</span></label>
          <input type="date" id="date" required>
        </div>
        <div class="form-group">
          <label>ê²¬ì ë²ˆí˜¸ <span class="required">*</span></label>
          <input type="text" id="number" placeholder="ì˜ˆì‹œ) DLP_250707-1" required>
        </div>
      </div>
    </div>

    <!-- ê³µê¸‰ì ì •ë³´ -->
    <div class="section">
      <h2 class="section-title">ê³µê¸‰ì ì •ë³´ <span class="info-badge">ê³ ì •</span></h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ê³µê¸‰ì</label>
          <input type="text" value="(ì£¼)ë°”ì´í…í…Œí¬ë†€ë¡œì§€" readonly>
        </div>
        <div class="form-group">
          <label>ë‹´ë‹¹ì <span class="required">*</span></label>
          <select id="supplier-person" required>
            <option value="" data-email="" data-phone="" data-id="" disabled selected hidden>ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì´í›ˆìˆ˜ ì´ì‚¬" data-email="hslee@bitekps.com" data-phone="010-3252-0593" data-id="A">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì´í›ˆìˆ˜ ì´ì‚¬</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì°¨ì¬ì› ì°¨ì¥" data-email="cjw@bitekps.com" data-phone="010-5035-7791" data-id="B">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì°¨ì¬ì› ì°¨ì¥</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ í•˜ì² ìš© ì°¨ì¥" data-email="cyha@bitekps.com" data-phone="010-6206-7656" data-id="C">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ í•˜ì² ìš© ì°¨ì¥</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ë…¸ì¬ìµ ì°¨ì¥" data-email="jake@bitekps.com" data-phone="010-6419-0945" data-id="D">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ë…¸ì¬ìµ ì°¨ì¥</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì „ì¤€ì˜ ê³¼ì¥" data-email="methu@bitekps.com" data-phone="010-2866-4914" data-id="E">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì „ì¤€ì˜ ê³¼ì¥</option>
            <option value="ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì¥ì§„í˜¸ ëŒ€ë¦¬" data-email="jhjang@bitekps.com" data-phone="010-9999-4401" data-id="F">ì• ë‹ˆíŠ¸ë¡ ì‚¬ì—…ë¶€ ì¥ì§„í˜¸ ëŒ€ë¦¬</option>
          </select>
        </div>
        <div class="form-group">
          <label>ë‹´ë‹¹ì ID</label>
          <input type="text" id="supplier-person-id" readonly placeholder="ìë™ì…ë ¥">
        </div>
        <div class="form-group">
          <label>ì´ë©”ì¼</label>
          <input type="email" id="supplier-email" readonly placeholder="ìë™ì…ë ¥">
        </div>
        <div class="form-group">
          <label>ì „í™”ë²ˆí˜¸</label>
          <input type="tel" id="supplier-phone" readonly placeholder="ìë™ì…ë ¥">
        </div>
      </div>
    </div>
    <!-- ìˆ˜ì‹ ì ì •ë³´ -->
    <div class="section">
      <h2 class="section-title">ìˆ˜ì‹ ì ì •ë³´</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>íšŒì‚¬ëª… <span class="required">*</span></label>
          <input type="text" id="receiver-company" required placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>
        <div class="form-group">
          <label>ë‹´ë‹¹ì</label>
          <input type="text" id="receiver-person" placeholder="ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>
        <div class="form-group">
          <label>ì´ë©”ì¼</label>
          <input type="email" id="receiver-email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>
        <div class="form-group">
          <label>ì „í™”ë²ˆí˜¸</label>
          <input type="tel" id="receiver-phone" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
        </div>
      </div>
    </div>

    <!-- ê²¬ì ì œí’ˆ ì„ íƒ -->
    <div class="section">
      <h2 class="section-title">ê²¬ì ì œí’ˆ ì„ íƒ</h2>
      <div class="form-group">
        <label>ì œí’ˆ ìœ í˜• <span class="required">*</span></label>
        <select id="product-category" required>
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="ì¥ë¹„">ì¥ë¹„</option>
          <option value="ì†Œëª¨í’ˆ">ì†Œëª¨í’ˆ</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
      </div>
    </div>
    <!-- ì œí’ˆì •ë³´ -->
    <div class="section">
      <h2 class="section-title">ì œí’ˆì •ë³´ <span class="info-badge">ìµœëŒ€ 10ê°œ</span></h2>
      <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button type="button" id="add-product" class="add-btn">â• ì œí’ˆì¶”ê°€</button>
        <button type="button" id="duplicate-product" class="add-btn">ğŸ“‹ ì œí’ˆë³µì œ</button>
      </div>
      <div id="products-area"></div>
    </div>

    <!-- ê¸°íƒ€ì •ë³´ -->
    <div class="section">
      <h2 class="section-title">ê¸°íƒ€ì •ë³´</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ê²¬ì ìœ íš¨ê¸°ê°„</label>
          <input type="text" id="quote-validity" value="ê²¬ì ì¼ë¡œë¶€í„° 4ì£¼">
        </div>
        <div class="form-group">
          <label>ë‚©ê¸°ì¼ <span class="required">*</span></label>
          <input type="text" id="delivery-date" value="ì…ê¸ˆí™•ì¸ì¼ë¡œë¶€í„° 2ì£¼ ì´ë‚´" required>
        </div>
        <div class="form-group full-width">
          <label>ì œí’ˆêµìœ¡ <span class="required">*</span></label>
          <select id="product-training" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì œí’ˆ ë‚©í’ˆì‹œ ì‚¬ìš©ì êµìœ¡ì„ ì§„í–‰ í•©ë‹ˆë‹¤.">ì œí’ˆ ë‚©í’ˆì‹œ ì‚¬ìš©ì êµìœ¡ì„ ì§„í–‰ í•©ë‹ˆë‹¤.</option>
            <option value="ì—”ì§€ë‹ˆì–´ ë°©ë¬¸ ì„¤ì¹˜êµìœ¡(300,000ì›(ë¶€ê°€ì„¸ë³„ë„) ì…ë‹ˆë‹¤.(ì„¤ì¹˜ ë©”ë‰´ì–¼, ë™ì˜ìƒ ì œê³µ)">ì—”ì§€ë‹ˆì–´ ë°©ë¬¸ ì„¤ì¹˜êµìœ¡(300,000ì›(ë¶€ê°€ì„¸ë³„ë„) ì…ë‹ˆë‹¤.(ì„¤ì¹˜ ë©”ë‰´ì–¼, ë™ì˜ìƒ ì œê³µ)</option>
            <option value="ì—”ì§€ë‹ˆì–´ ë°©ë¬¸ ì„¤ì¹˜êµìœ¡(250,000ì›(ë¶€ê°€ì„¸ë³„ë„) ì…ë‹ˆë‹¤.(ì„¤ì¹˜ ë©”ë‰´ì–¼, ë™ì˜ìƒ ì œê³µ)">ì—”ì§€ë‹ˆì–´ ë°©ë¬¸ ì„¤ì¹˜êµìœ¡(250,000ì›(ë¶€ê°€ì„¸ë³„ë„) ì…ë‹ˆë‹¤.(ì„¤ì¹˜ ë©”ë‰´ì–¼, ë™ì˜ìƒ ì œê³µ)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ì œì¶œ ë²„íŠ¼ -->
    <div class="action-buttons">
      <button type="button" id="preview-btn" class="btn btn-primary" style="flex: 1;">
        ğŸ“„ ê²¬ì ì„œ ìƒì„±í•˜ê¸°
      </button>
      <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">
        ğŸ  ì²˜ìŒí™”ë©´ìœ¼ë¡œ
      </button>
    </div>
  </div>
</div>
<script>
// 1. ìƒˆë¡œìš´ ì œí’ˆ ë¶„ë¥˜ êµ¬ì¡° (CSV ê¸°ë°˜)
const majorCategories = {
  "ì• ë‹ˆíŠ¸ë¡ ": [
    "ì»¬ëŸ¬ë¼ë²¨í”„ë¦°í„°",
    "ì»¬ëŸ¬ íŒŒìš°ì¹˜&ë¼ë²¨ í”„ë¦°í„°\n(ë‚±ì¥ ê³µê¸‰ ë°©ì‹)",
    "ì˜µì…˜ (ANY-002)",
    "ì˜µì…˜ (PRO10)",
    "ì†Œëª¨í’ˆ"
  ],
  "RFID": [
    "RFID í”„ë¦°í„°",
    "RFID  í•¸ë“œ í—¬ë“œ ë¦¬ë”ê¸°",
    "ê³ ì •í˜• ì•ˆí…Œë‚˜",
    "RFID íŒ¨í‚¤ì§€",
    "RFID í”„ë¡œê·¸ë¨",
    "RFID ì†Œëª¨í’ˆ"
  ]
};

// 2. ì†Œëª¨í’ˆ ì„ íƒ ì‹œ ì˜µì…˜ë“¤
const consumableOptions = {
  "ANY-002": "ANY-002",
  "1040 4ìƒ‰ ": "1040 4ìƒ‰",
  "1050 5ìƒ‰": "1050 5ìƒ‰",
  "EPSON CW-C4040A": "EPSON CW-C4040A",
  "EPSON CW-C6040A": "EPSON CW-C6040A",
  "EPSON CW-C6540A": "EPSON CW-C6540A",
  "ANYPACK": "ANYPACK",
  "ë¼ë²¨ ì†Œëª¨í’ˆ": "ë¼ë²¨ ì†Œëª¨í’ˆ",
  "AT-2": "AT-2"
};

// 3. ì œí’ˆ ë°ì´í„° (CSV ê¸°ë°˜)
const productData = {
  // ì• ë‹ˆíŠ¸ë¡  - ì˜µì…˜ (ANY-002)
  "ì˜µì…˜ (ANY-002)": [
    { name: "ANY-002 ì¥ë¹„í…Œì´ë¸”", detail: "ANY-002 ì „ìš© í…Œì´ë¸” / 600x1800 , ì „ìš©í…Œì´ë¸”", price: "ë¬´ìƒì œê³µ" },
    { name: "ë¦¬ì™€ì¸ë”", detail: "8ì¸ì¹˜ ì „ìš© ë¦¬ì™€ì¸ë”", price: "1000000" },
    { name: "ì¶œë ¥ S/W", detail: "ANY-002 ì „ìš© ì¶œë ¥ ë³€í™˜ í”„ë¡œê·¸ë¨ (bitek label s/w)", price: "1000000" }
  ],
  // ì• ë‹ˆíŠ¸ë¡  - ì˜µì…˜ (PRO10)
  "ì˜µì…˜ (PRO10)": [
    { name: "ë¦¬ì™€ì¸ë” (5ì¸ì¹˜)", detail: "ì¶œë ¥ëœ ë¼ë²¨ ìš©ì§€ë¥¼ ë¡¤ë¡œ ê°ì•„ì£¼ëŠ” ê¸°ëŠ¥", price: "500000" },
    { name: "ë¼ë²¨ ì¶œë ¥ S./W", detail: "ë¼ë²¨ ì¶œë ¥ í¸ì§‘ í”„ë¡œê·¸ë¨ / ê°€ë³€ ë°ì´í„° / ë„˜ë²„ë§ ê¸°ëŠ¥ ë“±", price: "700000" }
  ],
  // ì• ë‹ˆíŠ¸ë¡  - ì»¬ëŸ¬ë¼ë²¨í”„ë¦°í„°
  "ì»¬ëŸ¬ë¼ë²¨í”„ë¦°í„°": [
    { name: "ANY-002", detail: "- í”„ë¦°í„° ì†ë„ : 34/36 PPM (ë¶„ë‹¹ ì•½ 9.3m)\n - ì—°ì† ìš©ì§€ í”„ë¦°í„° ì†ë„ : 20/16/8 PPM (ë¶„ë‹¹ 6 m)\n - ìš©ì§€ë¬´ê²Œ : 64~250gsm\n - í•´ìƒë„ : 600 x 1200DPI\n - ìš©ì§€í¬ê¸° : min 65mm / max 215mm \n - ì—°ì†ìš©ì§€ : 8.5 iinch (215mm)\n - ê¸°ë³¸ë©”ëª¨ë¦¬ : 256MB\n-  ì§€ì›ë¯¸ë””ì–´ : Art paper , PET , PP ì§€ì›\n- í† ë„ˆìš©ëŸ‰(5% coverage,) : ëª¨ë…¸ 11,000ë§¤(3,300 meter)\n      (A4 ê¸°ì¤€)         ì»¬ëŸ¬ 11,500ë§¤(3,450 meter)\n - ì´ë¯¸ì§€ë“œëŸ¼ : 28,000ë§¤\n - ì´ì†¡ë²¨íŠ¸ : 60,000ë§¤\n - ì •ì°©ê¸° : 60,000ë§¤\n - ì‚¬ìš©ì „ë ¥ : 220v\n - ì„¼ì„œëª¨ë“ˆ : Gap ì„¼ì‹±ëª¨ë“œ(ë¼ë²¨ ì‚¬ì´ê°„ê²© 3mm í•„ìˆ˜)\n - ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n - OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n\nìµœì´ˆ ì„¤ì¹˜ ì‹œ í† ë„ˆ, ë“œëŸ¼ë“± ì†Œëª¨í’ˆì€ ì¥ì°©ë˜ì–´ ë‚©í’ˆ ë©ë‹ˆë‹¤.", price: "20000000" },
    { name: "PRO 1040 4ìƒ‰ ", detail: "ì—°ì† ìš©ì§€ í”„ë¦°í„° ì†ë„ : ìµœëŒ€ 9M/ë¶„ë‹¹, ê¸°ë³¸ 5M/ë¶„ë‹¹\n\n- í•´ìƒë„ : 1200 x 1200 dpi\n- ìƒ‰ìƒ : CMYK (4ìƒ‰ëª¨ë¸)\n- ìš©ì§€í­ : 25.4mm~130mm\n- ìš©ì§€ê¸¸ì´ : 12.7mm~1320.8mm\n- ì¸ì‡„ í­ : ìµœëŒ€ 125mm\n- ì¸ì‡„ ìµœì†Œì—¬ë°± : ìƒí•˜ì¢Œìš° ê° 2.12mm\n- ì»¤íŒ… ê°€ëŠ¥ ìš©ì§€ê¸¸ì´ : ìµœì†Œ 101.6mm\n- ë¡¤ì§ê²½ : ìµœëŒ€ 203.2mm(8ì¸ì¹˜)\n- ë¯¸ë””ì–´ë‘ê»˜ : 0.076mm~0.250mm\n- ì„¼ì„œëª¨ë“ˆ : Gap ì„¼ì‹±ëª¨ë“œ(ë¼ë²¨ ì‚¬ì´ê°„ê²© 3mm í•„ìˆ˜)\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)", price: "10980000" },
    { name: "PRO 1050 5ìƒ‰", detail: "ì—°ì† ìš©ì§€ í”„ë¦°í„° ì†ë„ : ìµœëŒ€ 9M/ë¶„ë‹¹, ê¸°ë³¸ 5M/ë¶„ë‹¹\n\n- í•´ìƒë„ : 1200 x 1200 dpi\n- ìƒ‰ìƒ : CMYK+W (5ìƒ‰ëª¨ë¸)\n- ìš©ì§€í­ : 25.4mm~130mm\n- ìš©ì§€ê¸¸ì´ : 12.7mm~1320.8mm\n- ì¸ì‡„ í­ : ìµœëŒ€ 125mm\n- ì¸ì‡„ ìµœì†Œì—¬ë°± : ìƒí•˜ì¢Œìš° ê° 2.12mm\n- ì»¤íŒ… ê°€ëŠ¥ ìš©ì§€ê¸¸ì´ : ìµœì†Œ 101.6mm\n- ë¡¤ì§ê²½ : ìµœëŒ€ 203.2mm(8ì¸ì¹˜)\n- ë¯¸ë””ì–´ë‘ê»˜ : 0.076mm~0.250mm\n- ì„¼ì„œëª¨ë“ˆ : Gap ì„¼ì‹±ëª¨ë“œ(ë¼ë²¨ ì‚¬ì´ê°„ê²© 3mm í•„ìˆ˜)\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)", price: "14540000" },
    { name: "EPSON CW-C4040A", detail: "ê³ í’ˆì§ˆ ê³ ì†ì¸ì‡„(8ì¸ì¹˜ëª© ì¶œë ¥ê°€ëŠ¥ ë¼ë²¨ í”„ë¦°í„°)\n\n- í•´ìƒë„ : 1200 x 1200 dpi- ìƒ‰ìƒ : CMYK 4ìƒ‰\n- ìš©ì§€í­ : 21.4mm~104mm\n- ìë™ë…¸ì¦ê²€ì‚¬ê¸°ëŠ¥ , ì„ ëª…í•œ ë°”ì½”ë“œ ì¸ì‡„\n- ë¯¸ë””ì–´ë‘ê»˜ : 0.076mm~0.250mm\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n(ë³¸ ì œí’ˆì˜ ì´ˆê¸°ì—ëŠ” C,M,Y ì‰í¬ë§Œ ë™ë´‰ë˜ì–´ ìˆìŠµë‹ˆë‹¤.)\n\nì´ë²¤íŠ¸ ì¦ì • : C,M,Y,K ì‰í¬ í•œì„¸íŠ¸ ë¬´ìƒì¦ì •", price: "2500000" },
    { name: "EPSON CW-C6040A", detail: "ê³ í’ˆì§ˆ ê³ ì†ì¸ì‡„(4ì¸ì¹˜í­ ì¶œë ¥ê°€ëŠ¥ ë¼ë²¨ í”„ë¦°í„°)\n\n- í•´ìƒë„ : 1200 x 1200 dpi- ìƒ‰ìƒ : CMYK 4ìƒ‰\n- ìš©ì§€í­ : 21.4mm~112mm\n- ì¸ì‡„ê°€ëŠ¥í­ : 101.6mm\n- ìë™ë…¸ì¦ê²€ì‚¬ê¸°ëŠ¥ , ì„ ëª…í•œ ë°”ì½”ë“œ ì¸ì‡„\n- ë¯¸ë””ì–´ë‘ê»˜ : 0.076mm~0.250mm\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n(ë³¸ ì œí’ˆì˜ ì´ˆê¸°ì—ëŠ” C,M,Y ì‰í¬ë§Œ ë™ë´‰ë˜ì–´ ìˆìŠµë‹ˆë‹¤.)\n- í¬ê¸° : 340x565x325mm\n- ë¬´ê²Œ :ì•½ 22.5kg\n\nì´ë²¤íŠ¸ ì¦ì • : C,M,Y,K ì‰í¬ í•œì„¸íŠ¸ ë¬´ìƒì¦ì •", price: "2900000" },
    { name: "EPSON CW-C6540A", detail: "ê³ í’ˆì§ˆ ê³ ì†ì¸ì‡„(8ì¸ì¹˜í­ ì¶œë ¥ê°€ëŠ¥ ë¼ë²¨ í”„ë¦°í„°)\n\n- í•´ìƒë„ : 1200 x 1200 dpi- ìƒ‰ìƒ : CMYK 4ìƒ‰\n- ìš©ì§€í­ : 21.4mm~215.9mm\n- ì¸ì‡„ê°€ëŠ¥í­ : 210mm\n- ìë™ë…¸ì¦ê²€ì‚¬ê¸°ëŠ¥ , ì„ ëª…í•œ ë°”ì½”ë“œ ì¸ì‡„\n- ë¯¸ë””ì–´ë‘ê»˜ : 0.076mm~0.250mm\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n(ë³¸ ì œí’ˆì˜ ì´ˆê¸°ì—ëŠ” C,M,Y ì‰í¬ë§Œ ë™ë´‰ë˜ì–´ ìˆìŠµë‹ˆë‹¤.)\n- í¬ê¸° : 444 x 515 x 326mm\n- ë¬´ê²Œ :ì•½ 25.5kg\n\nì´ë²¤íŠ¸ ì¦ì • : C,M,Y,K ì‰í¬ í•œì„¸íŠ¸ ë¬´ìƒì¦ì •", price: "3800000" },
    { name: "AT-1(ë‚±ì¥ë°©ì‹ í”„ë¦°í„°)", detail: "ì»¬ëŸ¬&í‘ë°± ì¶œë ¥ì´ ê°€ëŠ¥í•œ LED LASER PRINTER\n\n- í•´ìƒë„ : 1200 x 1200 dpi- ìƒ‰ìƒ : CMYK 4ìƒ‰\n- ìš©ì§€í­ : 55mm~216mm , ê¸¸ì´ 91~1320mm\n- ì¸ì‡„ì†ë„ : ìµœëŒ€ì†ë„ 1.5ì´ˆë‹¹ 1ë§¤\n- ìš©ì§€ë‘ê»˜: 52~320gsm\n- ê¸°ë³¸ë©”ëª¨ë¦¬ : 1GB\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n- í¬ê¸° : 290x395x430mm (í”„ë¦°í„° only)\n (ì´ˆê¸° ì œí’ˆì—ëŠ” C,M,Y,K í† ë„ˆê°€ ì¥ì°©ë˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.)\n (ë¼ë²¨ì§€ 100ë§¤ ì„œë¹„ìŠ¤ ì œê³µ ë° ì¶œë ¥ê°€ì´ë“œ ì œê³µ)", price: "900000" }
  ],
  // ì• ë‹ˆíŠ¸ë¡  - ì»¬ëŸ¬ íŒŒìš°ì¹˜&ë¼ë²¨ í”„ë¦°í„°
  "ì»¬ëŸ¬ íŒŒìš°ì¹˜&ë¼ë²¨ í”„ë¦°í„°\n(ë‚±ì¥ ê³µê¸‰ ë°©ì‹)": [
    { name: "AT-2", detail: "ì»¬ëŸ¬&í‘ë°± ì¶œë ¥ì´ ê°€ëŠ¥í•œ LED LASER PRINTER\n\n- í•´ìƒë„ : 1200 x 2400 dpi\n- ìƒ‰ìƒ : CMYK 4ìƒ‰\n- ìš©ì§€í­ : 89mm~320mm , ê¸¸ì´ 98~1200mm\n- ì¸ì‡„ì†ë„ : ìµœëŒ€ì†ë„ ë¶„ë‹¹ 55ë§¤(ìµœê³ ì†ë„ ê¸°ì¤€)\n- ìš©ì§€ë‘ê»˜: 52~300gsm\n- ê¸°ë³¸ë©”ëª¨ë¦¬ : 4GB\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n- í¬ê¸° : 620x720.5x699.1mm (í”„ë¦°í„° only)\n (ì´ˆê¸° ì œí’ˆì—ëŠ” C,M,Y,K í† ë„ˆê°€ ì¥ì°©ë˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.)", price: "4500000" },
    { name: "AT-3", detail: "ì»¬ëŸ¬&í‘ë°± ì¶œë ¥ì´ ê°€ëŠ¥í•œ LED LASER PRINTER\n\n- í•´ìƒë„ : 1200 x 1200 dpi\n- ìƒ‰ìƒ : CMYK + W (5ìƒ‰)\n- ìš©ì§€í­ : 89mm~320mm , ê¸¸ì´ 98~1200mm\n- ì¸ì‡„ì†ë„ : A4 50ppm / A3 28PPM (ì‚¬ë¬´ìš©ì§€ ê¸°ì¤€)\n- ìš©ì§€ë‘ê»˜: 52~320gsm , MP TRAY : 52~360gsm\n- ê¸°ë³¸ë©”ëª¨ë¦¬ : 2GB\n- ì¸í„°í˜ì´ìŠ¤ : ê³ ì†USB/ìœ ì„ LAN\n- OS í˜¸í™˜ : Windows 7, 8, 8.1,10,11(32&64bit)\n- í¬ê¸° :  625(L) x 699(W) x 640(H)mm , 116kg (ì†Œëª¨í’ˆ í¬í•¨)\n (ì´ˆê¸° ì œí’ˆì—ëŠ” í† ë„ˆê°€ ì¥ì°©ë˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.)", price: "11000000" }
  ],
  // RFID - í•¸ë“œ í—¬ë“œ ë¦¬ë”ê¸°
  "RFID  í•¸ë“œ í—¬ë“œ ë¦¬ë”ê¸°": [
    { name: "AT-907", detail: "PDA íƒ€ì… ì¼ì²´í˜• í•¸ë“œí—¬ë“œ ë¦¬ë”ê¸°\nRFID : UHF\nì•ˆë“œë¡œì´ë“œ íƒ€ì…", price: "1400000" },
    { name: "M3 ORANGE PLUS RFID GUN(43211710-22738770)", detail: "CPU : Cortex-A8 833MHz\t\t\t\nOS : Window Mobile 6.5\t\t\t\në©”ëª¨ë¦¬ : ROM 256MB, RAM 1GB\t\t\t\nDisplay : 3.5\"\" Color TFT LCD\t\t\t\në°”ì½”ë“œ ìŠ¤ìºë„ˆ : 1D ê¸°ë³¸, 2D ì˜µì…˜\t\t\t\në°°í„°ë¦¬ : Li-Ion 3,300mAh\t\t\t\nRFID : Gen-2, ISO 18000-6C\t\t\t", price: "2300000,1900000" }
  ],
  // RFID - í”„ë¦°í„°
  "RFID í”„ë¦°í„°": [
    { name: "Blackfish BT-200(43212116-25231260)", detail: "í•´ìƒë„ : 300DPI (1mm : 12dot)\t\t\në©”ëª¨ë¦¬ : Flash 256MB, SDRAM 512MB\t\t\në¼ë²¨í­ : 25mm ~ 118mm\t\t\t\nì¸ì‡„í­ : 25mm ~ 104mm\t\t\t\nì¸í„°í˜ì´ìŠ¤ : USB2.0 / RS-232-/TCP/IP\t\nì¶œë ¥ë°©ì‹ : ì—´ì „ì‚¬ / ê°ì—´ë°©ì‹\t\t\nRFID : Gen-2, ISO 18000-6C\t\t\nLCD : COLOR TFT LCD\t\t\t\ní¬ê¸° : 512 mm (L) x 291 mm (H) x 274 mm (W)\nì¤‘ëŸ‰ : 15 Kg\t\t\t\nRFID í”„ë¦°í„° ë¬´ìƒ ìœ ì§€ë³´ìˆ˜ 1ë…„ ì—°ì¥\nì œì¡°ì‚¬ : ãˆœë°”ì´í…í…Œí¬ë†€ë¡œì§€", price: "3200000,2500000" },
    { name: "Blackfish BT-100(43212116-23491762)", detail: "í•´ìƒë„ : 300DPI (1mm : 12dot)\t\t\t\në©”ëª¨ë¦¬ : Flash 128MB, SDRAM 32MB\t\t\t\në¼ë²¨í­ : 25mm ~ 118mm\t\t\t\nì¸ì‡„í­ : 25mm ~ 105mm\t\t\t\nì¸í„°í˜ì´ìŠ¤ : USB\t\t\t\nì¶œë ¥ë°©ì‹ : ì—´ì „ì‚¬ / ê°ì—´ë°©ì‹\t\t\t\nRFID : Gen-2, ISO 18000-6C\t\t\t\nLCD :3.2ì¸ì¹˜ ì»¬ëŸ¬ í„°ì¹˜ ìŠ¤í¬ë¦°\t\t\t\n       Auto Calibration Switch\t\t\t\ní¬ê¸° : 468mm(L) x 308mm(H) x 270mm(W)\t\t\t\nì¤‘ëŸ‰ : 13.6 Kg\t\t\t\nRFID í”„ë¦°í„° ë¬´ìƒ ìœ ì§€ë³´ìˆ˜ 2ë…„ ì—°ì¥\t\t\t", price: "3200000,2500000" },
    { name: "BT-002 pro\t", detail: "í•´ìƒë„ : 300DPI (1mm : 12dot)\t\t\në©”ëª¨ë¦¬ : Flash 8MB, SDRAM 16MB\t\t\në¼ë²¨í­ : 25mm ~ 118mm\t\t\t\nì¸ì‡„í­ : 25mm ~ 104mm\t\t\t\nì¸í„°í˜ì´ìŠ¤ : USB2.0 / RS-232-/TCP/IP\t\nì¶œë ¥ë°©ì‹ : ì—´ì „ì‚¬ / ê°ì—´ë°©ì‹\t\t\nRFID : Gen-2, ISO 18000-6C\t\t\nLCD : COLOR TFT LCD\t\t\t\ní¬ê¸° : 512 mm (L) x 291 mm (H) x 274 mm (W)\nì¤‘ëŸ‰ : 15 Kg\t\t\t\nì œ ì œì¡°ì‚¬ : ãˆœë°”ì´í…í…Œí¬ë†€ë¡œì§€", price: "3200000,2500000" },
    { name: "BT-003 Pro", detail: "í•´ìƒë„ : 300DPI (1mm : 12dot)\t\t\në©”ëª¨ë¦¬ : Flash 8MB, SDRAM 32MB\t\t\në¼ë²¨í­ : 25mm ~ 118mm\t\t\t\nì¸ì‡„í­ : 25mm ~ 104mm\t\t\t\nì¸í„°í˜ì´ìŠ¤ : USB2.0 / RS-232-C\t\nì¶œë ¥ë°©ì‹ : ì—´ì „ì‚¬ / ê°ì—´ë°©ì‹\t\t\nRFID : ISO/IEC 14443/A _ ISO/IEC 15693\t\nRFIDì£¼íŒŒìˆ˜ : HFëŒ€ì—­ / 13.56MHz\ní¬ê¸° : 540 mm (L) x 287 mm (H) x 268 mm (W)\nì¤‘ëŸ‰ : 15 Kg\t\t\t\nì œì¡°ì‚¬ : ãˆœë°”ì´í…í…Œí¬ë†€ë¡œì§€", price: "4500000,3500000" }
  ],
  // RFID - ê³ ì •í˜• ì•ˆí…Œë‚˜
  "ê³ ì •í˜• ì•ˆí…Œë‚˜": [
    { name: " IDRO260-919", detail: "ëª¨ë¸ëª… : IDRO260-919\níƒ€ ì… : Circular ANT\nì¤‘ì‹¬ ì£¼íŒŒìˆ˜ : 920 MHz\nì¼€ì´ë¸” 6M í¬í•¨", price: "200000" }
  ],
  // RFID - í”„ë¡œê·¸ë¨
  "RFID í”„ë¡œê·¸ë¨": [
    { name: "ANY-IMS", detail: "RFID ì…ì¶œê³  , ì¬ê³ ê´€ë¦¬ ì†”ë£¨ì…˜ í”„ë¡œê·¸ë¨", price: "9000000" }
  ],
  // RFID - íŒ¨í‚¤ì§€
  "RFID íŒ¨í‚¤ì§€": [
    { name: "ANY-Finder Plus", detail: "RFID  í”„ë¦°í„° / RFID í”„ë¦°í„° ì „ìš© í”„ë¡œê·¸ë¨ / \nRFID ì¼ì²´í˜• í•¸ë“œ ë¦¬ë”ê¸° / ë¦¬ë”ê¸° ì „ìš© í”„ë¡œê·¸ë¨", price: "6600000" },
    { name: "Any-Finder", detail: "RFID ì¼ì²´í˜• í•¸ë“œ ë¦¬ë”ê¸° / ì „ìš© ì•± í”„ë¡œê·¸ë¨", price: "2900000" },
    { name: "Any-Gate", detail: "ê³ ì •ì‹ ë¦¬ë”ê¸°/ ì•ˆí…Œë‚˜/ í„°ì¹˜ ëª¨ë‹ˆí„°/ ë¯¸ë‹ˆ PC/ ì…ì¶œê³  ê´€ë¦¬ í”„ë¡œê·¸ë¨", price: "13500000" }
  ],
  // RFID - ì†Œëª¨í’ˆ
  "RFID ì†Œëª¨í’ˆ": [
    { name: "ì¡°ë‹¬íƒœê·¸(2500ë§¤/ë¡¤)", detail: "ì¡°ë‹¬íƒœê·¸, 94x24, 2500ë§¤/ë¡¤", price: "575000,375000" },
    { name: "ì°¨íì¬_ì†Œí”„íŠ¸íƒ€ì…(100ê°œ/ë°•ìŠ¤)", detail: "ì°¨íì¬, 95x25x3, ì†Œí”„íŠ¸íƒ€ì…, 100ê°œ/ë°•ìŠ¤", price: "100000,50000" },
    { name: "ì—´ì „ì‚¬ë¦¬ë³¸(ì™ìŠ¤ë ˆì§„ 300ë¯¸í„°)", detail: "ì—´ì „ì‚¬ë¦¬ë³¸, ì™ìŠ¤ë ˆì§„, 110x300m", price: "43000,30000" },
    { name: "ë ›ì¹˜í˜•íƒœê·¸(ê°œ)", detail: "ë ˆì¹˜ ë° ì¼€ì´ë¸”íƒ€ì´, ê°œ(200ê°œ/ë¬¶ìŒ)", price: "60000,30000" },
    { name: "ë¬´ì§€íƒœê·¸(2500ë§¤/ë¡¤)", detail: "ë¬´ì§€íƒœê·¸, 94 x 24 , 2500ë§¤/ë¡¤", price: "325000" },
    { name: "ì‚¼ì„±ì¤‘ê³µì—… ì œì‘íƒœê·¸", detail: "100 x 35  NFC  ì „ìš© íƒœê·¸", price: "" },
    { name: "ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì› ì œì‘íƒœê·¸", detail: "RFID ë¼ë²¨", price: "300" },
    { name: "LGí™”í•™ ì „ìš© íƒœê·¸", detail: "100 x 60", price: "" }
  ]
};

// 4. ì†Œëª¨í’ˆ ë°ì´í„° (CSV ê¸°ë°˜)
const consumableData = {
  "ANY-002": [
    { name: "K TONER", detail: "ë†ë„ 5% A4 ê¸°ì¤€ ì•½ 11,000ë§¤ ì‚¬ìš©", price: "100000" },
    { name: "CYAN TONER", detail: "ë†ë„ 5% A4 ê¸°ì¤€ ì•½ 11,000ë§¤ ì‚¬ìš©", price: "125000" },
    { name: "MAGENTA TONER", detail: "ë†ë„ 5% A4 ê¸°ì¤€ ì•½ 11,000ë§¤ ì‚¬ìš©", price: "125000" },
    { name: " YELLOW TONER", detail: "ë†ë„ 5% A4 ê¸°ì¤€ ì•½ 11,000ë§¤ ì‚¬ìš©", price: "125000" },
    { name: "K DRUM", detail: "A4 ê¸°ì¤€ 28,000ë§¤ ì‚¬ìš©", price: "100000" },
    { name: "CYAN DRUM", detail: "A4 ê¸°ì¤€ 28,000ë§¤ ì‚¬ìš©", price: "100000" },
    { name: "MAGENTA DRUM", detail: "A4 ê¸°ì¤€ 28,000ë§¤ ì‚¬ìš©", price: "100000" },
    { name: " YELLOW DRUM", detail: "A4 ê¸°ì¤€ 28,000ë§¤ ì‚¬ìš©", price: "100000" },
    { name: "Fuser ", detail: "A4 ê¸°ì¤€ 60,000ë§¤ ì‚¬ìš©", price: "270000" },
    { name: "ë²¨íŠ¸", detail: "A4 ê¸°ì¤€ 60,000ë§¤ ì‚¬ìš©", price: "270000" }
  ],
  "1040 4ìƒ‰ ": [
    { name: "1040 CYAN TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1040 MAGENTA TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1040 YELLOW TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1040 K TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1040 Fuser(ì •ì°©ê¸°)", detail: "A6 100x150 ê¸°ì¤€ 150,000ë§¤ ì‚¬ìš©", price: "495000" },
    { name: "1040 Belt(ë²¨íŠ¸)", detail: "A6 100x150 ê¸°ì¤€ 150,000ë§¤ ì‚¬ìš©", price: "295000" },
    { name: "1040 íí† ë„ˆí†µ", detail: "A6 100x150 ê¸°ì¤€ 25,000ë§¤ ì‚¬ìš©", price: "45000" }
  ],
  "1050 5ìƒ‰": [
    { name: "1050 CYAN TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1050 MAGENTA TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1050 YELLOW TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1050 K TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "225000" },
    { name: "1050 WHITE TONER", detail: "(100x150 ê¸°ì¤€ ì•½ 15,000~20,000ë§¤ ì¶œë ¥ê°€ëŠ¥ ë†ë„5% ê¸°ì¤€)", price: "295000" },
    { name: "1050 Fuser(ì •ì°©ê¸°)", detail: "A6 100x150 ê¸°ì¤€ 150,000ë§¤ ì‚¬ìš©", price: "495000" },
    { name: "1050 Belt(ë²¨íŠ¸)", detail: "A6 100x150 ê¸°ì¤€ 150,000ë§¤ ì‚¬ìš©", price: "295000" },
    { name: "1050 íí† ë„ˆí†µ", detail: "A6 100x150 ê¸°ì¤€ 25,000ë§¤ ì‚¬ìš©", price: "45000" }
  ],
  "EPSON CW-C4040A": [
    { name: "C ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 1,500ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "58000" },
    { name: "M ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 1,500ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "58000" },
    { name: "Y ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 1,500ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "58000" },
    { name: "K ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 1,500ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "58000" },
    { name: "íì‰í¬ë°•ìŠ¤", detail: "EPSON CW-C4040A ì „ìš© íì‰í¬ë°•ìŠ¤", price: "41000" }
  ],
  "EPSON CW-C6040A": [
    { name: "C ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "M ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "Y ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "K ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "íì‰í¬ë°•ìŠ¤", detail: "EPSON CW-C6040A ì „ìš© íì‰í¬ë°•ìŠ¤", price: "41000" }
  ],
  "EPSON CW-C6540A": [
    { name: "C ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "M ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "Y ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "K ink", detail: "ë¼ë²¨ ì‚¬ì´ì¦ˆ 100x100 ê¸°ì¤€ ì•½ 3,000ì¥ ì¶œë ¥ ê°€ëŠ¥ (ë†ë„5% ê¸°ì¤€)", price: "65000" },
    { name: "íì‰í¬ë°•ìŠ¤", detail: "EPSON CW-C6540A ì „ìš© íì‰í¬ë°•ìŠ¤", price: "41000" }
  ],
  "ANYPACK": [
    { name: "K TONER", detail: "A4 38,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "150000" },
    { name: "CYAN TONER", detail: "A4 38,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "172000" },
    { name: "MAGENTA TONER", detail: "A4 38,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "172000" },
    { name: " YELLOW TONER", detail: "A4 38,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "172000" },
    { name: "WHITE TONER", detail: "A4 38,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "264000" },
    { name: "K DRUM", detail: "A4 ê¸°ì¤€ 40,000ì¥ ì¶œë ¥ê°€ëŠ¥", price: "194000" },
    { name: "CYAN DRUM", detail: "A4 ê¸°ì¤€ 40,000ì¥ ì¶œë ¥ê°€ëŠ¥", price: "194000" },
    { name: "MAGENTA DRUM", detail: "A4 ê¸°ì¤€ 40,000ì¥ ì¶œë ¥ê°€ëŠ¥", price: "194000" },
    { name: " YELLOW DRUM", detail: "A4 ê¸°ì¤€ 40,000ì¥ ì¶œë ¥ê°€ëŠ¥", price: "194000" },
    { name: "WHITE DRUM", detail: "A4 ê¸°ì¤€ 40,000ì¥ ì¶œë ¥ê°€ëŠ¥", price: "210000" },
    { name: "FUSER ", detail: "A4 ê¸°ì¤€ 150,000ë§¤ ì¶œë ¥ê°€ëŠ¥", price: "430000" },
    { name: "BELT", detail: "A4 ê¸°ì¤€ 150,000ë§¤ ì¶œë ¥ê°€ëŠ¥", price: "360000" }
  ],
  "ë¼ë²¨ ì†Œëª¨í’ˆ": [
    { name: "ì•„íŠ¸ì§€", detail: "ê°€ë¡œ   x  ì„¸ë¡œ   , ë¡¤ë‹¹ ? ì¥ , ì¥ë‹¹ ë‹¨ê°€ ? ", price: "" },
    { name: "ìœ í¬ì§€", detail: "ê°€ë¡œ   x  ì„¸ë¡œ   , ë¡¤ë‹¹ ? ì¥ , ì¥ë‹¹ ë‹¨ê°€ ? ", price: "" },
    { name: "ì€ë¬´ PET", detail: "ê°€ë¡œ   x  ì„¸ë¡œ   , ë¡¤ë‹¹ ? ì¥ , ì¥ë‹¹ ë‹¨ê°€ ? ", price: "" },
    { name: "íˆ¬ëª… PET", detail: "ê°€ë¡œ   x  ì„¸ë¡œ   , ë¡¤ë‹¹ ? ì¥ , ì¥ë‹¹ ë‹¨ê°€ ? ", price: "" },
    { name: "ê¸°íƒ€", detail: "", price: "" }
  ],
  "AT-2": [
    { name: "K TONER", detail: "A4 26,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "150000" },
    { name: "CYAN TONER", detail: "A4 25,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "230000" },
    { name: "MAGENTA TONER", detail: "A4 25,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "230000" },
    { name: " YELLOW TONER", detail: "A4 25,000ì¥ ì¶œë ¥ê°€ëŠ¥ (ë†ë„ 5% ê¸°ì¤€)", price: "230000" },
    { name: "FUSER ", detail: "", price: "595000" },
    { name: "BELT", detail: "", price: "" }
  ]
};

let productCount = 0;
const maxProducts = 10;

function createProductSet(idx) {
  // ëŒ€ë¶„ë¥˜ ì˜µì…˜
  const majorOptions = [
    '<option value="">ëŒ€ë¶„ë¥˜</option>',
    '<option value="ì• ë‹ˆíŠ¸ë¡ ">ì• ë‹ˆíŠ¸ë¡ </option>',
    '<option value="RFID">RFID</option>'
  ].join('');

  return `
  <div class="product-set" data-index="${idx}">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span style="font-weight: 600; color: #2A8486;">ì œí’ˆ ${idx+1}</span>
      <div style="display: flex; gap: 4px;">
        <button type="button" onclick="moveProductUp(this)" class="move-btn" title="ìœ„ë¡œ ì´ë™">â–²</button>
        <button type="button" onclick="moveProductDown(this)" class="move-btn" title="ì•„ë˜ë¡œ ì´ë™">â–¼</button>
        <button type="button" onclick="duplicateProduct(this)" class="remove-btn" style="background: #2A8486; color: white;">ë³µì œ</button>
        ${idx>0?'<button type="button" onclick="removeProduct(this)" class="remove-btn">ì‚­ì œ</button>':''}
      </div>
    </div>

    <div class="product-field-group">
      <div class="product-row">
        <div style="flex: 1;">
          <label class="product-field-label">ëŒ€ë¶„ë¥˜</label>
          <select class="product-major-category">
            ${majorOptions}
          </select>
        </div>
        <div style="flex: 1;">
          <label class="product-field-label">êµ¬ë¶„</label>
          <select class="product-type">
            <option value="">êµ¬ë¶„(ì„ íƒ)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="product-field-group">
      <label class="product-field-label">ì œí’ˆëª…</label>
      <select class="product-name">
        <option value="">ì œí’ˆëª…</option>
      </select>
    </div>

    <div class="product-field-group">
      <label class="product-field-label">ìƒì„¸ì •ë³´</label>
      <textarea class="product-detail" placeholder="ì œí’ˆìƒì„¸ì •ë³´" rows="4" style="resize: vertical; font-family: inherit; font-size: inherit;"></textarea>
    </div>

    <div class="product-field-group three-columns">
      <div>
        <label class="product-field-label">ìˆ˜ëŸ‰</label>
        <input class="product-qty" type="number" min="1" placeholder="ìˆ˜ëŸ‰">
      </div>
      <div>
        <label class="product-field-label">ë‹¨ê°€(ì›)</label>
        <select class="product-price-select" style="display:none;">
          <option value="">ê°€ê²© ì„ íƒ</option>
        </select>
        <input class="product-price" type="number" min="0" placeholder="ê³µê¸‰ë‹¨ê°€(ì›)">
      </div>
      <div>
        <label class="product-field-label">í•©ê³„(ì›)</label>
        <input class="product-total product-total-highlight" type="text" placeholder="í•©ê³„(VATë³„ë„ê°€ê²©)" readonly>
      </div>
    </div>

    <div class="product-field-group">
      <label class="product-field-label">ë¹„ê³ </label>
      <input class="product-note" type="text" maxlength="20" placeholder="ë¹„ê³ (20ìê¹Œì§€ ì…ë ¥ê°€ëŠ¥)">
    </div>
  </div>
  `;
}

// ëŒ€ë¶„ë¥˜ ë³€ê²½ ì‹œ êµ¬ë¶„ ì˜µì…˜ ì—…ë°ì´íŠ¸
function updateProductTypeOptions(majorSelect, typeSelect) {
  const major = majorSelect.value;
  typeSelect.innerHTML = '<option value="">êµ¬ë¶„(ì„ íƒ)</option>';

  if(majorCategories[major]) {
    majorCategories[major].forEach(type => {
      const opt = document.createElement('option');
      opt.value = type;
      opt.textContent = type;
      typeSelect.appendChild(opt);
    });

    // ì• ë‹ˆíŠ¸ë¡  ì„ íƒ ì‹œ 'ì§ì ‘ì…ë ¥' ì˜µì…˜ ì¶”ê°€
    if(major === 'ì• ë‹ˆíŠ¸ë¡ ') {
      const directInputOpt = document.createElement('option');
      directInputOpt.value = 'ì§ì ‘ì…ë ¥';
      directInputOpt.textContent = 'ì§ì ‘ì…ë ¥';
      typeSelect.appendChild(directInputOpt);
    }
  }
}

// 'ì§ì ‘ì…ë ¥' ì„ íƒ ì‹œ ëª¨ë“  í•„ë“œë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë³€ê²½
function enableDirectInput(typeSelect) {
  const productSet = typeSelect.closest('.product-set');

  // êµ¬ë¶„ í•„ë“œë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë³€ê²½
  const typeInput = document.createElement('input');
  typeInput.type = 'text';
  typeInput.className = 'product-type-input';
  typeInput.placeholder = 'êµ¬ë¶„ ì…ë ¥';
  typeInput.style.cssText = typeSelect.style.cssText;
  typeInput.value = '';
  typeInput.dataset.directInput = 'true';
  typeSelect.parentNode.replaceChild(typeInput, typeSelect);

  // ì œí’ˆëª… í•„ë“œë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë³€ê²½
  const nameSelect = productSet.querySelector('.product-name');
  if(nameSelect && nameSelect.tagName === 'SELECT') {
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.className = 'product-name';
    nameInput.placeholder = 'ì œí’ˆëª… ì…ë ¥';
    nameInput.style.cssText = nameSelect.style.cssText;
    nameInput.value = '';
    nameInput.dataset.directInput = 'true';
    nameSelect.parentNode.replaceChild(nameInput, nameSelect);
  }

  // ì œí’ˆìƒì„¸ì •ë³´ëŠ” ì´ë¯¸ textareaì´ë¯€ë¡œ ë³€ê²½ ë¶ˆí•„ìš”
  const detailInput = productSet.querySelector('.product-detail');
  if(detailInput) {
    detailInput.placeholder = 'ì œí’ˆìƒì„¸ì •ë³´ ì…ë ¥';
    detailInput.value = '';
  }

  // ë‹¨ê°€ í•„ë“œ í™œì„±í™” (ì´ë¯¸ inputì´ë¯€ë¡œ placeholderë§Œ ë³€ê²½)
  const priceInput = productSet.querySelector('.product-price');
  if(priceInput) {
    priceInput.placeholder = 'ê³µê¸‰ë‹¨ê°€(ì›) ì…ë ¥';
    priceInput.value = '';
    priceInput.readOnly = false;
  }

  // ì†Œëª¨í’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
  const consumableSelect = productSet.querySelector('.consumable-option');
  if(consumableSelect) {
    consumableSelect.style.display = 'none';
  }
}

// select í˜•íƒœë¡œ ë³µì› (ì§ì ‘ì…ë ¥ì—ì„œ ë‹¤ë¥¸ ì˜µì…˜ìœ¼ë¡œ ë³€ê²½ ì‹œ)
function restoreSelectFields(typeSelect) {
  const productSet = typeSelect.closest('.product-set');

  // êµ¬ë¶„ í•„ë“œê°€ inputì¸ ê²½ìš° selectë¡œ ë³µì›
  const typeInput = productSet.querySelector('.product-type-input');
  if(typeInput && typeInput.dataset.directInput === 'true') {
    const newTypeSelect = document.createElement('select');
    newTypeSelect.className = 'product-type';
    newTypeSelect.innerHTML = '<option value="">êµ¬ë¶„(ì„ íƒ)</option>';
    newTypeSelect.style.cssText = typeInput.style.cssText;
    typeInput.parentNode.replaceChild(newTypeSelect, typeInput);

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ í•„ìš”
    const majorSelect = productSet.querySelector('.product-major-category');
    updateProductTypeOptions(majorSelect, newTypeSelect);
    newTypeSelect.value = typeSelect.value;
  }

  // ì œí’ˆëª… í•„ë“œê°€ inputì¸ ê²½ìš° selectë¡œ ë³µì›
  const nameInput = productSet.querySelector('.product-name');
  if(nameInput && nameInput.tagName === 'INPUT' && nameInput.dataset.directInput === 'true') {
    const newNameSelect = document.createElement('select');
    newNameSelect.className = 'product-name';
    newNameSelect.innerHTML = '<option value="">ì œí’ˆëª…</option>';
    newNameSelect.style.cssText = nameInput.style.cssText;
    delete newNameSelect.dataset.directInput;
    nameInput.parentNode.replaceChild(newNameSelect, nameInput);
  }
}

// êµ¬ë¶„ ë³€ê²½ ì‹œ ì œí’ˆëª… ì˜µì…˜ ì—…ë°ì´íŠ¸
function updateProductNameOptions(typeSelect, nameSelect, consumableSelect) {
  const type = typeSelect.value;

  console.log("=== updateProductNameOptions ë””ë²„ê¹… ===");
  console.log("ì„ íƒëœ êµ¬ë¶„:", type);

  // 'ì§ì ‘ì…ë ¥' ì„ íƒ ì‹œ ëª¨ë“  í•„ë“œë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë³€ê²½
  if(type === 'ì§ì ‘ì…ë ¥') {
    enableDirectInput(typeSelect);
    return;
  }

  // ê¸°ì¡´ ë¡œì§: select í˜•íƒœë¡œ ë³µì› (ì§ì ‘ì…ë ¥ì—ì„œ ë‹¤ë¥¸ ì˜µì…˜ìœ¼ë¡œ ë³€ê²½ ì‹œ)
  restoreSelectFields(typeSelect);

  nameSelect.innerHTML = '<option value="">ì œí’ˆëª…</option>';

  // ê¸°ì¡´ ì†Œëª¨í’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì°¾ê¸°
  const existingConsumableSelect = typeSelect.parentNode.querySelector('.consumable-option');

  // ì†Œëª¨í’ˆì¼ ë•Œ
  if(type === "ì†Œëª¨í’ˆ") {
    console.log("ì†Œëª¨í’ˆ ì„ íƒë¨ - ì†Œëª¨í’ˆ ì„ íƒ ì‹œ ë“œë¡­ë‹¤ìš´ ìƒì„±");
    // ì†Œëª¨í’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ì´ ì—†ìœ¼ë©´ ì¶”ê°€
    if(!existingConsumableSelect) {
      const newConsumableSelect = document.createElement('select');
      newConsumableSelect.className = 'consumable-option';
      newConsumableSelect.style.marginRight = '8px';
      newConsumableSelect.innerHTML = '<option value="">ì¥ë¹„ ì„ íƒ</option>' +
        Object.keys(consumableOptions).map(key => `<option value="${key}">${consumableOptions[key]}</option>`).join('');
      typeSelect.insertAdjacentElement('afterend', newConsumableSelect);
      newConsumableSelect.addEventListener('change', function() {
        updateProductNameOptions(typeSelect, nameSelect, newConsumableSelect);
      });
      consumableSelect = newConsumableSelect;
    } else {
      consumableSelect = existingConsumableSelect;
      existingConsumableSelect.style.display = 'block';
    }
    // ì†Œëª¨í’ˆ ì„ íƒ ì‹œ ì œí’ˆëª… ì˜µì…˜ ë³€ê²½
    const selectedConsumable = consumableSelect.value;
    console.log("ì„ íƒëœ ì†Œëª¨í’ˆ ëª¨ë¸:", selectedConsumable);
    if(consumableData[selectedConsumable]) {
      console.log("í•´ë‹¹ ëª¨ë¸ì˜ ì†Œëª¨í’ˆ ëª©ë¡:", consumableData[selectedConsumable]);
      consumableData[selectedConsumable].forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.name;
        opt.textContent = item.name;
        nameSelect.appendChild(opt);
      });
    } else {
      console.log("í•´ë‹¹ ëª¨ë¸ì˜ ì†Œëª¨í’ˆ ë°ì´í„°ê°€ ì—†ìŒ");
    }
  } else {
    // ì†Œëª¨í’ˆì´ ì•„ë‹ˆë©´ ê¸°ì¡´ ë°©ì‹
    if(existingConsumableSelect) {
      existingConsumableSelect.style.display = 'none';
    }
    if(productData[type]) {
      const names = [...new Set(productData[type].map(item=>item.name))];
      names.forEach(name=>{
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        nameSelect.appendChild(opt);
      });
    }
  }
}

function updateProductDetail(typeSelect, nameSelect, detailInput, priceInput, priceSelect) {
  const type = typeSelect.value;
  const name = nameSelect.value;
  
  console.log("=== updateProductDetail ë””ë²„ê¹… ===");
  console.log("ì„ íƒëœ êµ¬ë¶„(type):", type);
  console.log("ì„ íƒëœ ì œí’ˆëª…(name):", name);
  console.log("productDataì—ì„œ í•´ë‹¹ êµ¬ë¶„ ì¡´ì¬ ì—¬ë¶€:", !!productData[type]);
  console.log("í•´ë‹¹ êµ¬ë¶„ì˜ ì œí’ˆ ëª©ë¡:", productData[type]);
  
  // ì†Œëª¨í’ˆì¼ ë•Œ
  if(type === "ì†Œëª¨í’ˆ") {
    console.log("ì†Œëª¨í’ˆ ì²˜ë¦¬ ì¤‘...");
    const consumableSelect = typeSelect.parentNode.querySelector('.consumable-option');
    console.log("ì†Œëª¨í’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´:", consumableSelect);
    if(consumableSelect && consumableData[consumableSelect.value]) {
      console.log("ì†Œëª¨í’ˆ ë°ì´í„°ì—ì„œ ê²€ìƒ‰:", consumableData[consumableSelect.value]);
      const found = consumableData[consumableSelect.value].find(item => item.name === name);
      console.log("ì°¾ì€ ì†Œëª¨í’ˆ:", found);
      if(found) {
        detailInput.value = found.detail;
        updatePriceOptions(found.price, priceInput, priceSelect);
      } else {
        detailInput.value = '';
        priceInput.value = '';
        priceSelect.style.display = 'none';
        priceInput.style.display = 'block';
      }
    }
  } else {
    // ì¼ë°˜ ì œí’ˆ
    console.log("ì¼ë°˜ ì œí’ˆ ì²˜ë¦¬ ì¤‘...");
    if(productData[type]) {
      console.log("ì œí’ˆ ë°ì´í„°ì—ì„œ ê²€ìƒ‰:", productData[type]);
      const found = productData[type].find(item=>item.name===name);
      console.log("ì°¾ì€ ì œí’ˆ:", found);
      if(found) {
        detailInput.value = found.detail;
        updatePriceOptions(found.price, priceInput, priceSelect);
      } else {
        detailInput.value = '';
        priceInput.value = '';
        priceSelect.style.display = 'none';
        priceInput.style.display = 'block';
      }
    } else {
      console.log("í•´ë‹¹ êµ¬ë¶„ì˜ ì œí’ˆ ë°ì´í„°ê°€ ì—†ìŒ");
      detailInput.value = '';
      priceInput.value = '';
      priceSelect.style.display = 'none';
      priceInput.style.display = 'block';
    }
  }
}

// ê°€ê²© ì˜µì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updatePriceOptions(priceStr, priceInput, priceSelect) {
  console.log("=== updatePriceOptions ë””ë²„ê¹… ===");
  console.log("ì…ë ¥ëœ ê°€ê²© ë¬¸ìì—´:", priceStr);
  
  if(!priceStr || priceStr === '') {
    priceInput.value = '';
    priceSelect.style.display = 'none';
    priceInput.style.display = 'block';
    priceInput.removeAttribute('readonly');
    priceInput.removeAttribute('disabled');
    return;
  }
  
  // ê°€ê²©ì´ ì‰¼í‘œë¡œ êµ¬ë¶„ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  if(priceStr.includes(',')) {
    const prices = priceStr.split(',').map(p => p.trim()).filter(p => p !== 'í…ìŠ¤íŠ¸');
    console.log("ë¶„ë¦¬ëœ ê°€ê²©ë“¤:", prices);
    if(prices.length > 1) {
      // ì—¬ëŸ¬ ê°€ê²©ì´ ìˆìœ¼ë©´ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
      priceSelect.innerHTML = '<option value="">ê°€ê²© ì„ íƒ</option>';
      prices.forEach(price => {
        const opt = document.createElement('option');
        opt.value = price;
        opt.textContent = price;
        priceSelect.appendChild(opt);
      });
      priceSelect.style.display = 'block';
      priceInput.style.display = 'none';
      priceInput.value = '';
      console.log("ì—¬ëŸ¬ ê°€ê²© - ë“œë¡­ë‹¤ìš´ í‘œì‹œ");
    } else {
      // í•˜ë‚˜ì˜ ê°€ê²©ë§Œ ìˆìœ¼ë©´ ì§ì ‘ ì…ë ¥
      priceInput.value = prices[0];
      priceSelect.style.display = 'none';
      priceInput.style.display = 'block';
      priceInput.removeAttribute('readonly');
      priceInput.removeAttribute('disabled');
      console.log("í•˜ë‚˜ì˜ ê°€ê²© - ì§ì ‘ ì…ë ¥ í•„ë“œ í‘œì‹œ");
    }
  } else {
    // ë‹¨ì¼ ê°€ê²©
    priceInput.value = priceStr;
    priceSelect.style.display = 'none';
    priceInput.style.display = 'block';
    priceInput.removeAttribute('readonly');
    priceInput.removeAttribute('disabled');
    console.log("ë‹¨ì¼ ê°€ê²© - ì§ì ‘ ì…ë ¥ í•„ë“œ í‘œì‹œ");
  }
}

function updateProductTotal(qtyInput, priceInput, totalInput) {
  const qty = Number(qtyInput.value);
  const price = Number(priceInput.value);
  if(qty && price) {
    totalInput.value = (qty * price).toLocaleString();
  } else {
    totalInput.value = '';
  }
}

function removeProduct(btn) {
  if(productCount <= 1) {
    alert('ìµœì†Œ 1ê°œì˜ ì œí’ˆì€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }
  btn.closest('.product-set').remove();
  productCount--;
  document.getElementById('add-product').disabled = false;
  renumberProducts();
}

// ì œí’ˆ ë²ˆí˜¸ ë‹¤ì‹œ ë§¤ê¸°ê¸° í•¨ìˆ˜
function renumberProducts() {
  document.querySelectorAll('.product-set').forEach((el, idx)=>{
    el.dataset.index = idx;
    const headerDiv = el.querySelector('div');
    const span = headerDiv.querySelector('span');
    span.textContent = `ì œí’ˆ ${idx+1}`;
  });
}

// ì œí’ˆ ë³µì œ í•¨ìˆ˜ (í•´ë‹¹ ì œí’ˆ ë°”ë¡œ ë’¤ì— ì¶”ê°€)
function duplicateProduct(btn) {
  if(productCount >= maxProducts) {
    alert('ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }

  const productSet = btn.closest('.product-set');
  const clonedSet = productSet.cloneNode(true);

  // ì…ë ¥ê°’ ìœ ì§€í•˜ë©´ì„œ ë³µì œ
  const originalInputs = productSet.querySelectorAll('input, select, textarea');
  const clonedInputs = clonedSet.querySelectorAll('input, select, textarea');

  originalInputs.forEach((input, idx) => {
    if(input.type === 'checkbox' || input.type === 'radio') {
      clonedInputs[idx].checked = input.checked;
    } else {
      clonedInputs[idx].value = input.value;
    }
  });

  // ë³µì œí•œ ì œí’ˆì„ í˜„ì¬ ì œí’ˆ ë°”ë¡œ ë‹¤ìŒì— ì‚½ì…
  productSet.insertAdjacentElement('afterend', clonedSet);
  productCount++;

  if(productCount >= maxProducts) {
    document.getElementById('add-product').disabled = true;
  }

  renumberProducts();
  rebindProductEvents();
}

// ëª¨ë“  ì œí’ˆì˜ ì´ë²¤íŠ¸ë¥¼ ë‹¤ì‹œ ë°”ì¸ë”©
function rebindProductEvents() {
  document.querySelectorAll('.product-set').forEach(productSet => {
    const majorSelect = productSet.querySelector('.product-major-category');
    const typeSelect = productSet.querySelector('.product-type');
    const nameSelect = productSet.querySelector('.product-name');
    const detailInput = productSet.querySelector('.product-detail');
    const qtyInput = productSet.querySelector('.product-qty');
    const priceInput = productSet.querySelector('.product-price');
    const priceSelect = productSet.querySelector('.product-price-select');
    const totalInput = productSet.querySelector('.product-total');

    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
    const newMajorSelect = majorSelect.cloneNode(true);
    const newTypeSelect = typeSelect.cloneNode(true);
    const newNameSelect = nameSelect.cloneNode(true);
    const newQtyInput = qtyInput.cloneNode(true);
    const newPriceInput = priceInput.cloneNode(true);
    const newPriceSelect = priceSelect.cloneNode(true);

    majorSelect.parentNode.replaceChild(newMajorSelect, majorSelect);
    typeSelect.parentNode.replaceChild(newTypeSelect, typeSelect);
    nameSelect.parentNode.replaceChild(newNameSelect, nameSelect);
    qtyInput.parentNode.replaceChild(newQtyInput, qtyInput);
    priceInput.parentNode.replaceChild(newPriceInput, priceInput);
    priceSelect.parentNode.replaceChild(newPriceSelect, priceSelect);

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    newMajorSelect.addEventListener('change', ()=>{
      updateProductTypeOptions(newMajorSelect, newTypeSelect);
      detailInput.value = '';
      newPriceInput.value = '';
      newNameSelect.value = '';
      newTypeSelect.value = '';
    });

    newTypeSelect.addEventListener('change', ()=>{
      updateProductNameOptions(newTypeSelect, newNameSelect, newTypeSelect.parentNode.querySelector('.consumable-option'));
      detailInput.value = '';
      newPriceInput.value = '';
      newNameSelect.value = '';
      newPriceSelect.style.display = 'none';
      newPriceInput.style.display = 'block';
    });

    newNameSelect.addEventListener('change', ()=>{
      if(newNameSelect.value === 'ê¸°íƒ€') {
        const textInput = document.createElement('input');
        textInput.type = 'text';
        textInput.className = 'product-name';
        textInput.placeholder = 'ì œí’ˆëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”';
        textInput.style.cssText = newNameSelect.style.cssText;
        textInput.style.width = '100%';
        textInput.style.flex = '1';
        textInput.style.marginTop = '0';

        newNameSelect.parentNode.replaceChild(textInput, newNameSelect);

        detailInput.value = '';
        newPriceInput.value = '';
        newPriceSelect.style.display = 'none';
        newPriceInput.style.display = 'block';
        newPriceInput.removeAttribute('readonly');
        newPriceInput.removeAttribute('disabled');
        totalInput.value = '';

        textInput.addEventListener('input', ()=>{
          updateProductTotal(newQtyInput, newPriceInput, totalInput);
        });

        textInput.focus();
      } else {
        updateProductDetail(newTypeSelect, newNameSelect, detailInput, newPriceInput, newPriceSelect);
        updateProductTotal(newQtyInput, newPriceInput, totalInput);
      }
    });

    newPriceSelect.addEventListener('change', ()=>{
      newPriceInput.value = newPriceSelect.value;
      newPriceSelect.style.display = 'none';
      newPriceInput.style.display = 'block';
      newPriceInput.removeAttribute('readonly');
      newPriceInput.removeAttribute('disabled');
      newPriceInput.focus();
      updateProductTotal(newQtyInput, newPriceInput, totalInput);
    });

    newQtyInput.addEventListener('input', ()=>updateProductTotal(newQtyInput, newPriceInput, totalInput));
    newPriceInput.addEventListener('input', ()=>updateProductTotal(newQtyInput, newPriceInput, totalInput));

    newPriceInput.addEventListener('click', ()=>{
      newPriceInput.removeAttribute('readonly');
      newPriceInput.removeAttribute('disabled');
    });
  });
}

// ì œí’ˆ ìœ„ë¡œ ì´ë™
function moveProductUp(btn) {
  const productSet = btn.closest('.product-set');
  const prevProduct = productSet.previousElementSibling;

  if(prevProduct && prevProduct.classList.contains('product-set')) {
    productSet.parentNode.insertBefore(productSet, prevProduct);
    renumberProducts();
  }
}

// ì œí’ˆ ì•„ë˜ë¡œ ì´ë™
function moveProductDown(btn) {
  const productSet = btn.closest('.product-set');
  const nextProduct = productSet.nextElementSibling;

  if(nextProduct && nextProduct.classList.contains('product-set')) {
    productSet.parentNode.insertBefore(nextProduct, productSet);
    renumberProducts();
  }
}

function addProductSet() {
  if(productCount >= maxProducts) return;
  const area = document.getElementById('products-area');
  area.insertAdjacentHTML('beforeend', createProductSet(productCount));
  productCount++;
  if(productCount >= maxProducts) {
    document.getElementById('add-product').disabled = true;
  }
  // ì´ë²¤íŠ¸ ë°”ì¸ë”©
  const sets = area.querySelectorAll('.product-set');
  const lastSet = sets[sets.length-1];
  const majorSelect = lastSet.querySelector('.product-major-category');
  const typeSelect = lastSet.querySelector('.product-type');
  const nameSelect = lastSet.querySelector('.product-name');
  const detailInput = lastSet.querySelector('.product-detail');
  const qtyInput = lastSet.querySelector('.product-qty');
  const priceInput = lastSet.querySelector('.product-price');
  const priceSelect = lastSet.querySelector('.product-price-select');
  const totalInput = lastSet.querySelector('.product-total');
  const noteInput = lastSet.querySelector('.product-note');

  // ëŒ€ë¶„ë¥˜ ë³€ê²½ ì‹œ êµ¬ë¶„ ì˜µì…˜ ì—…ë°ì´íŠ¸
  majorSelect.addEventListener('change', ()=>{
    updateProductTypeOptions(majorSelect, typeSelect);
    detailInput.value = '';
    priceInput.value = '';
    nameSelect.value = '';
    typeSelect.value = '';
  });
  
  // êµ¬ë¶„ ë³€ê²½ ì‹œ ì œí’ˆëª… ì˜µì…˜ ì—…ë°ì´íŠ¸
  typeSelect.addEventListener('change', ()=>{
    updateProductNameOptions(typeSelect, nameSelect, typeSelect.parentNode.querySelector('.consumable-option'));
    detailInput.value = '';
    priceInput.value = '';
    nameSelect.value = '';
    priceSelect.style.display = 'none';
    priceInput.style.display = 'block';
  });
  
  // ì œí’ˆëª… ë³€ê²½ ì‹œ ìƒì„¸ì •ë³´ ë° ê°€ê²© ìë™ ì…ë ¥
  nameSelect.addEventListener('change', ()=>{
    // 'ê¸°íƒ€' ì„ íƒ ì‹œ ë“œë¡­ë‹¤ìš´ì„ ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
    if(nameSelect.value === 'ê¸°íƒ€') {
      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.className = 'product-name';
      textInput.placeholder = 'ì œí’ˆëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”';
      textInput.style.cssText = nameSelect.style.cssText;
      textInput.style.width = '100%';
      textInput.style.flex = '1';
      textInput.style.marginTop = '0';
      
      // ë“œë¡­ë‹¤ìš´ì„ ì…ë ¥ í•„ë“œë¡œ êµì²´
      nameSelect.parentNode.replaceChild(textInput, nameSelect);
      
      // ìƒì„¸ì •ë³´ì™€ ê°€ê²© í•„ë“œ ì´ˆê¸°í™” (ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥)
      detailInput.value = '';
      priceInput.value = '';
      priceSelect.style.display = 'none';
      priceInput.style.display = 'block';
      priceInput.removeAttribute('readonly');
      priceInput.removeAttribute('disabled');
      
      // í•©ê³„ í•„ë“œ ì´ˆê¸°í™”
      totalInput.value = '';
      
      // ìƒˆë¡œìš´ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      textInput.addEventListener('input', ()=>{
        updateProductTotal(qtyInput, priceInput, totalInput);
      });
      
      textInput.focus();
    } else {
      updateProductDetail(typeSelect, nameSelect, detailInput, priceInput, priceSelect);
      updateProductTotal(qtyInput, priceInput, totalInput);
    }
  });
  
  // ê°€ê²© ì„ íƒ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ
  priceSelect.addEventListener('change', ()=>{
    console.log("ê°€ê²© ì„ íƒ ë“œë¡­ë‹¤ìš´ ë³€ê²½ë¨:", priceSelect.value);
    priceInput.value = priceSelect.value;
    // ê°€ê²© ì„ íƒ í›„ input í•„ë“œë¥¼ ë‹¤ì‹œ í‘œì‹œí•˜ì—¬ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ í•¨
    priceSelect.style.display = 'none';
    priceInput.style.display = 'block';
    // ì…ë ¥ í•„ë“œê°€ í¸ì§‘ ê°€ëŠ¥í•œì§€ í™•ì¸
    priceInput.removeAttribute('readonly');
    priceInput.removeAttribute('disabled');
    priceInput.focus(); // í¬ì»¤ìŠ¤ë¥¼ ì£¼ì–´ ì‚¬ìš©ìê°€ ë°”ë¡œ í¸ì§‘í•  ìˆ˜ ìˆë„ë¡ í•¨
    updateProductTotal(qtyInput, priceInput, totalInput);
  });
  
  // ìˆ˜ëŸ‰/ê°€ê²© ë³€ê²½ ì‹œ í•©ê³„ ìë™ ê³„ì‚°
  qtyInput.addEventListener('input', ()=>updateProductTotal(qtyInput, priceInput, totalInput));
  priceInput.addEventListener('input', ()=>updateProductTotal(qtyInput, priceInput, totalInput));
  
  // ê°€ê²© ì…ë ¥ í•„ë“œ í´ë¦­ ì‹œ í¸ì§‘ ê°€ëŠ¥í•˜ë„ë¡ ë³´ì¥
  priceInput.addEventListener('click', ()=>{
    priceInput.removeAttribute('readonly');
    priceInput.removeAttribute('disabled');
    priceInput.focus();
  });
  
  // ê°€ê²© ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ í¸ì§‘ ê°€ëŠ¥í•˜ë„ë¡ ë³´ì¥
  priceInput.addEventListener('focus', ()=>{
    priceInput.removeAttribute('readonly');
    priceInput.removeAttribute('disabled');
  });
  
  // ë¹„ê³  ì…ë ¥ ì œí•œ
  noteInput.addEventListener('input', ()=>{ if(noteInput.value.length>20) noteInput.value=noteInput.value.slice(0,20); });
}

// ì œí’ˆ ë³µì œ í•¨ìˆ˜
function duplicateLastProduct() {
  const productSets = document.querySelectorAll('.product-set');
  if(productSets.length === 0) {
    alert('ë³µì œí•  ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  if(productCount >= maxProducts) {
    alert('ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ë§ˆì§€ë§‰ ì œí’ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const lastSet = productSets[productSets.length - 1];

  // êµ¬ë¶„ í•„ë“œê°€ inputì¸ì§€ selectì¸ì§€ í™•ì¸ (ì§ì ‘ì…ë ¥ ëª¨ë“œ)
  const typeElement = lastSet.querySelector('.product-type') || lastSet.querySelector('.product-type-input');
  const isDirectInput = typeElement && typeElement.classList.contains('product-type-input');

  const lastData = {
    majorCategory: lastSet.querySelector('.product-major-category').value,
    type: typeElement ? typeElement.value : '',
    isDirectInput: isDirectInput,
    name: lastSet.querySelector('.product-name').tagName === 'INPUT' ?
          lastSet.querySelector('.product-name').value :
          lastSet.querySelector('.product-name').value,
    detail: lastSet.querySelector('.product-detail').value,
    qty: lastSet.querySelector('.product-qty').value,
    price: lastSet.querySelector('.product-price').value,
    note: lastSet.querySelector('.product-note').value,
    consumableValue: lastSet.querySelector('.consumable-option') ?
                    lastSet.querySelector('.consumable-option').value : null
  };
  
  // ìƒˆ ì œí’ˆ ì„¸íŠ¸ ì¶”ê°€
  addProductSet();
  
  // ë°©ê¸ˆ ì¶”ê°€ëœ ë§ˆì§€ë§‰ ì œí’ˆ ì„¸íŠ¸ì— ë°ì´í„° ì…ë ¥
  const newSets = document.querySelectorAll('.product-set');
  const newSet = newSets[newSets.length - 1];
  
  // ëŒ€ë¶„ë¥˜ ì„ íƒ
  const newMajorSelect = newSet.querySelector('.product-major-category');
  newMajorSelect.value = lastData.majorCategory;
  updateProductTypeOptions(newMajorSelect, newSet.querySelector('.product-type'));
  
  // êµ¬ë¶„ ì„ íƒ
  setTimeout(() => {
    // ì§ì ‘ì…ë ¥ ëª¨ë“œì¸ ê²½ìš°
    if(lastData.isDirectInput) {
      const newTypeSelect = newSet.querySelector('.product-type');
      newTypeSelect.value = 'ì§ì ‘ì…ë ¥';
      enableDirectInput(newTypeSelect);

      // ì§ì ‘ì…ë ¥ëœ ê°’ ë³µì›
      setTimeout(() => {
        const typeInput = newSet.querySelector('.product-type-input');
        if(typeInput) typeInput.value = lastData.type;

        const nameInput = newSet.querySelector('.product-name');
        if(nameInput) nameInput.value = lastData.name;

        const detailInput = newSet.querySelector('.product-detail');
        if(detailInput) detailInput.value = lastData.detail;

        const priceInput = newSet.querySelector('.product-price');
        if(priceInput) priceInput.value = lastData.price;

        newSet.querySelector('.product-qty').value = lastData.qty;
        newSet.querySelector('.product-note').value = lastData.note;
        updateProductTotal(newSet.querySelector('.product-qty'), newSet.querySelector('.product-price'), newSet.querySelector('.product-total'));
      }, 100);
      return;
    }

    // ì¼ë°˜ ëª¨ë“œ
    const newTypeSelect = newSet.querySelector('.product-type');
    newTypeSelect.value = lastData.type;
    updateProductNameOptions(newTypeSelect, newSet.querySelector('.product-name'), null);
    
    // ì†Œëª¨í’ˆì¸ ê²½ìš° ì†Œëª¨í’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì„¤ì •
    if(lastData.type === "ì†Œëª¨í’ˆ" && lastData.consumableValue) {
      setTimeout(() => {
        const consumableSelect = newSet.querySelector('.consumable-option');
        if(consumableSelect) {
          consumableSelect.value = lastData.consumableValue;
          updateProductNameOptions(newTypeSelect, newSet.querySelector('.product-name'), consumableSelect);
          
          // ì œí’ˆëª… ì„ íƒ
          setTimeout(() => {
            const nameElement = newSet.querySelector('.product-name');
            if(nameElement.tagName === 'INPUT') {
              nameElement.value = lastData.name;
            } else {
              nameElement.value = lastData.name;
            }
            updateProductDetail(newTypeSelect, nameElement, newSet.querySelector('.product-detail'), 
                             newSet.querySelector('.product-price'), newSet.querySelector('.product-price-select'));
            
            // ë‚˜ë¨¸ì§€ ì •ë³´ ì…ë ¥
            setTimeout(() => {
              newSet.querySelector('.product-qty').value = lastData.qty;
              newSet.querySelector('.product-note').value = lastData.note;
              updateProductTotal(newSet.querySelector('.product-qty'), newSet.querySelector('.product-price'), newSet.querySelector('.product-total'));
            }, 100);
          }, 100);
        }
      }, 100);
    } else {
      // ì¼ë°˜ ì œí’ˆì¸ ê²½ìš°
      setTimeout(() => {
        const nameElement = newSet.querySelector('.product-name');
        if(nameElement.tagName === 'INPUT') {
          nameElement.value = lastData.name;
        } else {
          nameElement.value = lastData.name;
        }
        updateProductDetail(newTypeSelect, nameElement, newSet.querySelector('.product-detail'), 
                         newSet.querySelector('.product-price'), newSet.querySelector('.product-price-select'));
        
        // ë‚˜ë¨¸ì§€ ì •ë³´ ì…ë ¥
        setTimeout(() => {
          newSet.querySelector('.product-qty').value = lastData.qty;
          newSet.querySelector('.product-note').value = lastData.note;
          updateProductTotal(newSet.querySelector('.product-qty'), newSet.querySelector('.product-price'), newSet.querySelector('.product-total'));
        }, 100);
      }, 100);
    }
  }, 100);
}

document.getElementById('add-product').addEventListener('click', addProductSet);
document.getElementById('duplicate-product').addEventListener('click', duplicateLastProduct);
addProductSet(); // ìµœì´ˆ 1ê°œ ì„¸íŠ¸ í‘œì‹œ

// ë‹´ë‹¹ì-ì—°ë½ì²˜ ë§¤í•‘
const supplierContacts = {
  "ì´í›ˆìˆ˜": "hslee@bitekps.com / 010-3252-0593",
  "ì°¨ì¬ì›": "cjw@bitekps.com / 010-5035-7791",
  "ì¥ì§„í˜¸": "jhjang@bitekps.com / 010-9999-4401",
  "í•˜ì² ìš©": "cyha@bitekps.com / 010-6206-7656",
  "ë…¸ì¬ìµ": "jake@bitekps.com / 010-6419-0945",
  "ì „ì¤€ì˜": "methu78@bitekps.com / 010-2866-4914"
};

document.getElementById('supplier-person').addEventListener('change', function() {
  const selected = this.options[this.selectedIndex];
  // ì—°ë½ì²˜ ìë™ í‘œì‹œ
  document.getElementById('supplier-email').value = selected.getAttribute('data-email') || '';
  document.getElementById('supplier-phone').value = selected.getAttribute('data-phone') || '';
  // ë‹´ë‹¹ìID ìë™ í‘œì‹œ
  document.getElementById('supplier-person-id').value = selected.getAttribute('data-id') || '';
});

// ê²¬ì ë²ˆí˜¸ ìë™ìƒì„± í•¨ìˆ˜ (ê°œì„ ë²„ì „)
async function autoFillEstimateNumber() {
  const dateVal = document.getElementById('date').value;
  const supplierSelect = document.getElementById('supplier-person');
  const supplierId = supplierSelect.options[supplierSelect.selectedIndex]?.getAttribute('data-id') || '';
  const numberInput = document.getElementById('number');
  
  if (!dateVal || !supplierId) return;

  // ë‚ ì§œ YYMMDD ë³€í™˜
  const yymmdd = dateVal.replace(/-/g, '').slice(2);
  
  // ë¡œë”© í‘œì‹œ
  numberInput.value = 'ìƒì„±ì¤‘...';
  numberInput.style.color = '#999';
  
  let count = 1;
  
  try {
    console.log('ê²¬ì ë²ˆí˜¸ ìƒì„± ì‹œì‘...');
    
    // 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì ìš©
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 5000);
    
    const res = await fetch('https://auto-estimate.onrender.com/estimate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ check_only: true }),
      signal: controller.signal
    });
    
    clearTimeout(timeoutId);
    
    if (res.ok) {
      const result = await res.json();
      if (result.pdf_count_today) count = result.pdf_count_today + 1;
      console.log('ì„œë²„ì—ì„œ ì¹´ìš´íŠ¸ ê°€ì ¸ì˜´:', count);
    } else {
      console.warn('API ì‘ë‹µ ì‹¤íŒ¨, ë¡œì»¬ ì¹´ìš´íŠ¸ ì‚¬ìš©');
      count = getLocalCount(yymmdd, supplierId);
    }
    
  } catch (error) {
    console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error.name);
    
    if (error.name === 'AbortError') {
      console.log('íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•œ ë¡œì»¬ ì¹´ìš´íŠ¸ ì‚¬ìš©');
    }
    
    // ë°±ì—…: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©
    count = getLocalCount(yymmdd, supplierId);
  }

  // ê²¬ì ë²ˆí˜¸ ìƒì„±
  const estimateNumber = `DLP${yymmdd}-${supplierId}-${count}`;
  numberInput.value = estimateNumber;
  numberInput.style.color = '#000';
  
  // ë¡œì»¬ ì¹´ìš´íŠ¸ ì €ì¥
  saveLocalCount(yymmdd, supplierId, count);
  
  console.log('ê²¬ì ë²ˆí˜¸ ìƒì„± ì™„ë£Œ:', estimateNumber);
}

// ë¡œì»¬ ì¹´ìš´íŠ¸ ê°€ì ¸ì˜¤ê¸°
function getLocalCount(yymmdd, supplierId) {
  const key = `count_${yymmdd}_${supplierId}`;
  const stored = localStorage.getItem(key);
  return stored ? parseInt(stored) + 1 : 1;
}

// ë¡œì»¬ ì¹´ìš´íŠ¸ ì €ì¥
function saveLocalCount(yymmdd, supplierId, count) {
  const key = `count_${yymmdd}_${supplierId}`;
  localStorage.setItem(key, count.toString());
}

// ê²¬ì ì¼ì, ë‹´ë‹¹ì ë³€ê²½ ì‹œ ìë™ìƒì„±
document.getElementById('date').addEventListener('change', autoFillEstimateNumber);
document.getElementById('supplier-person').addEventListener('change', autoFillEstimateNumber);

function collectEstimateData() {
  const fileId = new URLSearchParams(window.location.search).get("id");
  return {
    estimate_date: document.getElementById('date').value,
    estimate_number: document.getElementById('number').value,
    supplier_person: document.getElementById('supplier-person').options[document.getElementById('supplier-person').selectedIndex].text,
    supplier_email: document.getElementById('supplier-email').value,
    supplier_phone: document.getElementById('supplier-phone').value,
    receiver_company: document.getElementById('receiver-company').value,
    receiver_person: document.getElementById('receiver-person').value,
    receiver_email: document.getElementById('receiver-email').value,
    receiver_phone: document.getElementById('receiver-phone').value,
    product_category: document.getElementById('product-category').value,
    quote_validity: document.getElementById('quote-validity').value,
    delivery_date: document.getElementById('delivery-date').value,
    product_training: document.getElementById('product-training').value,
    fileId: fileId, // fileId ì¶”ê°€
    products: Array.from(document.querySelectorAll('.product-set')).map(function(set) {
      // ì œí’ˆëª… í•„ë“œê°€ inputì¸ì§€ selectì¸ì§€ í™•ì¸
      const nameElement = set.querySelector('.product-name');
      const productName = nameElement.tagName === 'INPUT' ? nameElement.value : nameElement.value;

      // êµ¬ë¶„ í•„ë“œê°€ inputì¸ì§€ selectì¸ì§€ í™•ì¸ (ì§ì ‘ì…ë ¥ ëª¨ë“œ)
      const typeElement = set.querySelector('.product-type') || set.querySelector('.product-type-input');
      const productType = typeElement ? typeElement.value : '';

      return {
        major_category: set.querySelector('.product-major-category').value,
        type: productType,
        name: productName,
        detail: set.querySelector('.product-detail').value,
        qty: Number(set.querySelector('.product-qty').value),
        price: Number(set.querySelector('.product-price').value.replace(/,/g, "") || 0),
        total: Number(set.querySelector('.product-total').value.replace(/,/g, "")),
        note: set.querySelector('.product-note').value
      };
    })
  };
}

function validateEstimateForm() {
  console.log("=== ê²¬ì ì„œ ìœ íš¨ì„± ê²€ì‚¬ ì‹œì‘ ===");
  
  // í•„ìˆ˜ ì…ë ¥ê°’ ì²´í¬
  const date = document.getElementById('date').value;
  const number = document.getElementById('number').value;
  const supplierPerson = document.getElementById('supplier-person').value;
  const receiverCompany = document.getElementById('receiver-company').value;
  const productCategory = document.getElementById('product-category').value;
  const deliveryDate = document.getElementById('delivery-date').value;
  
  console.log("ì…ë ¥ê°’ í™•ì¸:");
  console.log("- ê²¬ì ì¼ì:", date);
  console.log("- ê²¬ì ë²ˆí˜¸:", number);
  console.log("- ê³µê¸‰ì ë‹´ë‹¹ì:", supplierPerson);
  console.log("- ìˆ˜ì‹ ì íšŒì‚¬ëª…:", receiverCompany);
  console.log("- ê²¬ì ì œí’ˆ:", productCategory);
  console.log("- ë‚©ê¸°ì¼:", deliveryDate);
  
  if (!date) {
    console.log("âŒ ê²¬ì ì¼ì ëˆ„ë½");
    alert('ê²¬ì ì¼ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    return false;
  }
  if (!number) {
    console.log("âŒ ê²¬ì ë²ˆí˜¸ ëˆ„ë½");
    alert('ê²¬ì ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    return false;
  }
  if (!supplierPerson) {
    console.log("âŒ ê³µê¸‰ì ë‹´ë‹¹ì ëˆ„ë½");
    alert('ê³µê¸‰ì ë‹´ë‹¹ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    return false;
  }
  if (!receiverCompany) {
    console.log("âŒ ìˆ˜ì‹ ì íšŒì‚¬ëª… ëˆ„ë½");
    alert('ìˆ˜ì‹ ì íšŒì‚¬ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    return false;
  }
  // ê²¬ì ì œí’ˆ ì„ íƒ í•„ìˆ˜
  if (!productCategory) {
    console.log("âŒ ê²¬ì ì œí’ˆ ëˆ„ë½");
    alert('ê²¬ì ì œí’ˆì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    return false;
  }
  // ì œí’ˆì •ë³´ í•„ìˆ˜ê°’ ì²´í¬ (ë¹„ê³  ì œì™¸)
  const sets = document.querySelectorAll('.product-set');
  if (sets.length === 0) {
    alert('ì œí’ˆì •ë³´ë¥¼ 1ê°œ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    return false;
  }
  for (let i = 0; i < sets.length; i++) {
    const set = sets[i];
    const majorCategory = set.querySelector('.product-major-category').value;

    // êµ¬ë¶„ í•„ë“œê°€ inputì¸ì§€ selectì¸ì§€ í™•ì¸ (ì§ì ‘ì…ë ¥ ëª¨ë“œ)
    const typeElement = set.querySelector('.product-type') || set.querySelector('.product-type-input');
    const type = typeElement ? typeElement.value : '';

    const nameElement = set.querySelector('.product-name');
    const name = nameElement.tagName === 'INPUT' ? nameElement.value : nameElement.value;
    const detail = set.querySelector('.product-detail').value;
    const qty = set.querySelector('.product-qty').value;
    const price = set.querySelector('.product-price').value;
    const total = set.querySelector('.product-total').value;
    if (!majorCategory) {
      alert(`ì œí’ˆ ${i+1}ì˜ ëŒ€ë¶„ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!type) {
      alert(`ì œí’ˆ ${i+1}ì˜ êµ¬ë¶„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!name) {
      alert(`ì œí’ˆ ${i+1}ì˜ ì œí’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!detail) {
      alert(`ì œí’ˆ ${i+1}ì˜ ìƒì„¸ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!qty) {
      alert(`ì œí’ˆ ${i+1}ì˜ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!price && price !== 0) {
      alert(`ì œí’ˆ ${i+1}ì˜ ê³µê¸‰ë‹¨ê°€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    if (!total) {
      alert(`ì œí’ˆ ${i+1}ì˜ í•©ê³„ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.`);
      return false;
    }
  }
  // ë‚©ê¸°ì¼ í•„ìˆ˜
  if (!deliveryDate) {
    console.log("âŒ ë‚©ê¸°ì¼ ëˆ„ë½");
    alert('ë‚©ê¸°ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    return false;
  }
  
  // ì œí’ˆêµìœ¡ í•„ìˆ˜
  const productTraining = document.getElementById('product-training').value;
  if (!productTraining) {
    console.log("âŒ ì œí’ˆêµìœ¡ ëˆ„ë½");
    alert('ì œí’ˆêµìœ¡ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    return false;
  }
  
  console.log("âœ… ëª¨ë“  í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦ ì™„ë£Œ");
  return true;
}

async function sendEstimateToFastAPI() {
  console.log("=== ê²¬ì ì„œ ìƒì„± ì‹œì‘ ===");
  
  if (!validateEstimateForm()) {
    console.log("âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨");
    return;
  }
  
  console.log("âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼");
  
  const button = document.getElementById('preview-btn');
  const originalText = button.textContent;
  
  try {
    // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì ìš©
    button.disabled = true;
    button.classList.add('loading');
    button.textContent = 'ì²˜ë¦¬ ì¤‘...';
    
    // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°±ì„ ìœ„í•œ ì•½ê°„ì˜ ì§€ì—°
    await new Promise(resolve => setTimeout(resolve, 50));
    
    const data = collectEstimateData();
    let fileId = new URLSearchParams(window.location.search).get("id");
    
    // fileIdê°€ ì—†ê±°ë‚˜ í…œí”Œë¦¿ ë³€ìˆ˜ì¸ ê²½ìš° ìƒˆë¡œìš´ ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„±
    if (!fileId || fileId === "{{24.id}}" || fileId.includes("{{") || fileId.includes("}}")) {
      console.log("fileIdê°€ ì—†ê±°ë‚˜ í…œí”Œë¦¿ ë³€ìˆ˜ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ í…œí”Œë¦¿ì„ ìƒì„±í•©ë‹ˆë‹¤.");
    } else {
      console.log("ìœ íš¨í•œ fileIdê°€ ì´ë¯¸ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤:", fileId);
      data.fileId = fileId;
    }
    
    // fileIdê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ í…œí”Œë¦¿ ìƒì„±
    if (!fileId || fileId === "{{24.id}}" || fileId.includes("{{") || fileId.includes("}}")) {
      console.log("ìƒˆë¡œìš´ ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„± ì‹œì‘");
      console.log("í˜„ì¬ fileId:", fileId);
      console.log("fileId ê²€ì¦:", {
        isEmpty: !fileId,
        isTemplateVar: fileId === "{{24.id}}",
        containsTemplate: fileId && (fileId.includes("{{") || fileId.includes("}}"))
      });
      
      try {
        console.log("ê²¬ì ì„œ í…œí”Œë¦¿ ë³µì‚¬ API í˜¸ì¶œ ì¤‘...");
        // ê²¬ì ì„œ í…œí”Œë¦¿ ë³µì‚¬ API í˜¸ì¶œ
        const templateResponse = await fetch('https://auto-estimate.onrender.com/create-estimate-template', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        console.log("API ì‘ë‹µ ìƒíƒœ:", templateResponse.status);
        const templateResult = await templateResponse.json();
        console.log("API ì‘ë‹µ ê²°ê³¼:", templateResult);
        
        if (templateResult.status === "success") {
          console.log("ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„± ì„±ê³µ:", templateResult);
          fileId = templateResult.file_id; // fileId ë³€ìˆ˜ ì—…ë°ì´íŠ¸
          data.fileId = fileId;
          
          // URLì— fileId ì¶”ê°€
          const newUrl = new URL(window.location);
          newUrl.searchParams.set('id', fileId);
          window.history.replaceState({}, '', newUrl);
          console.log("URL ì—…ë°ì´íŠ¸ ì™„ë£Œ:", newUrl.toString());
        } else {
          console.error("ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨:", templateResult);
          alert("ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + templateResult.message);
          return;
        }
      } catch (error) {
        console.error("ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„± ì¤‘ ì˜¤ë¥˜:", error);
        alert("ê²¬ì ì„œ í…œí”Œë¦¿ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return;
      }
    } else {
      console.log("ê¸°ì¡´ fileId ì‚¬ìš©:", fileId);
      data.fileId = fileId;
    }

    // ê²¬ì ì œí’ˆ ì„ íƒ ê°’ ì €ì¥
    const productCategory = document.getElementById('product-category').value;

    // ì•ˆì „í•˜ê²Œ storageì— ì €ì¥ (localStorageì™€ sessionStorage ëª¨ë‘ ì‹œë„)
    try {
      localStorage.setItem('productCategory', productCategory);
      sessionStorage.setItem('productCategory', productCategory);
    } catch (e) {
      console.warn('Storage ì €ì¥ ì‹¤íŒ¨:', e);
    }

    // ìµœì†Œ ë¡œë”© ì‹œê°„ ì„¤ì • (ë„ˆë¬´ ë¹¨ë¦¬ ë„˜ì–´ê°€ëŠ” ê²ƒ ë°©ì§€)
    const startTime = Date.now();
    const minLoadingTime = 1500; // ìµœì†Œ 1.5ì´ˆ ë¡œë”©

    button.textContent = 'ê²¬ì ì„œ ìƒì„± ì¤‘...';

    console.log("ê²¬ì ì„œ ìƒì„± API í˜¸ì¶œ ì „ ë°ì´í„°:", data);
    console.log("ì‚¬ìš©í•  fileId:", fileId);

    const response = await fetch('https://auto-estimate.onrender.com/estimate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    console.log("ê²¬ì ì„œ ìƒì„± API ì‘ë‹µ:", result);

    button.textContent = 'ì™„ë£Œ ì¤‘...';

    if(result.status === "success") {
      // ìµœì†Œ ë¡œë”© ì‹œê°„ ë³´ì¥
      const elapsedTime = Date.now() - startTime;
      const remainingTime = Math.max(0, minLoadingTime - elapsedTime);

      setTimeout(() => {
        // ë°ì´í„° ì €ì¥ (localStorageì™€ sessionStorage ëª¨ë‘ ì‹œë„)
        const dataToStore = JSON.stringify(data);
        console.log('ì €ì¥í•  ë°ì´í„°:', dataToStore);

        try {
          localStorage.setItem('estimateData', dataToStore);
          sessionStorage.setItem('estimateData', dataToStore);
          console.log('Storage ì €ì¥ ì™„ë£Œ');
        } catch (e) {
          console.warn('Storage ì €ì¥ ì‹¤íŒ¨:', e);
          console.warn('localStorage ì‚¬ìš© ë¶ˆê°€ - ì‹œí¬ë¦¿ ëª¨ë“œì´ê±°ë‚˜ ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
        }

        console.log('preview.htmlë¡œ ì´ë™í•  fileId:', fileId);

        // fileIdë¥¼ URLì— í¬í•¨í•˜ì—¬ preview.htmlë¡œ ì´ë™
        if (fileId) {
          window.location.href = `preview.html?id=${fileId}`;
        } else {
          window.location.href = `preview.html`;
        }
      }, remainingTime);
    } else {
      alert('ì „ì†¡ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    }
  } catch (error) {
    console.error('ê²¬ì ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
    alert('ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  } finally {
    // ë²„íŠ¼ ìƒíƒœ ë³µì›
    button.disabled = false;
    button.classList.remove('loading');
    button.textContent = originalText;
  }
}

document.getElementById('preview-btn').addEventListener('click', sendEstimateToFastAPI);

// í˜ì´ì§€ ë¡œë“œ ì‹œ fileId ìƒíƒœ í™•ì¸ ë° ë°ì´í„° ë³µì›
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const fileId = urlParams.get("id");
  
  console.log("=== í˜ì´ì§€ ë¡œë“œ ë° ë°ì´í„° ë³µì› ì‹œì‘ ===");

  // 1. localStorage ë˜ëŠ” sessionStorageì—ì„œ ë°ì´í„° í™•ì¸
  let existingData = null;
  try {
    existingData = localStorage.getItem('estimateData');
    if (!existingData) {
      existingData = sessionStorage.getItem('estimateData');
      console.log('localStorageì— ë°ì´í„°ê°€ ì—†ì–´ sessionStorageì—ì„œ ë³µì› ì‹œë„');
    }
  } catch (e) {
    console.warn('Storage ì ‘ê·¼ ì‹¤íŒ¨:', e);
    try {
      existingData = sessionStorage.getItem('estimateData');
    } catch (e2) {
      console.error('sessionStorage ì ‘ê·¼ë„ ì‹¤íŒ¨:', e2);
    }
  }

  if (existingData) {
    try {
      const data = JSON.parse(existingData);
      console.log("ë³µì›í•  ë°ì´í„° ë°œê²¬:", data);

      // fileIdê°€ URLì— ì—†ê³  ì €ì¥ëœ ë°ì´í„°ì—ë§Œ ìˆëŠ” ê²½ìš° (ë’¤ë¡œê°€ê¸° ë“±)
      // í˜„ì¬ URLì˜ id íŒŒë¼ë¯¸í„°ê°€ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ
      if (!fileId && data.fileId) {
        console.log("URLì— IDê°€ ì—†ì–´ ì €ì¥ëœ ID ì‚¬ìš©:", data.fileId);
      }

      restoreFormData(data);

    } catch (e) {
      console.error("ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜:", e);
    }
  } else {
    console.log("ë³µì›í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ìœ¼ë¡œ ì œí’ˆ 1ê°œëŠ” addProductSet()ì´ ì•„ë˜ì—ì„œ í˜¸ì¶œë¨ (ê¸°ì¡´ ì½”ë“œ)
  }
});

// í¼ ë°ì´í„° ë³µì› í•¨ìˆ˜
function restoreFormData(data) {
  // 1. ê¸°ë³¸ í•„ë“œ ë³µì›
  if(data.estimate_date) document.getElementById('date').value = data.estimate_date;
  if(data.estimate_number) document.getElementById('number').value = data.estimate_number;
  if(data.receiver_company) document.getElementById('receiver-company').value = data.receiver_company;
  if(data.receiver_person) document.getElementById('receiver-person').value = data.receiver_person;
  if(data.receiver_email) document.getElementById('receiver-email').value = data.receiver_email;
  if(data.receiver_phone) document.getElementById('receiver-phone').value = data.receiver_phone;
  if(data.quote_validity) document.getElementById('quote-validity').value = data.quote_validity;
  if(data.delivery_date) document.getElementById('delivery-date').value = data.delivery_date;
  
  // 2. ê³µê¸‰ì ë‹´ë‹¹ì ì„ íƒ ë° ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
  if(data.supplier_person) {
    const supplierSelect = document.getElementById('supplier-person');
    // í…ìŠ¤íŠ¸ë¡œ ì˜µì…˜ ì°¾ê¸°
    for(let i=0; i<supplierSelect.options.length; i++) {
        if(supplierSelect.options[i].text === data.supplier_person) {
            supplierSelect.selectedIndex = i;
            // change ì´ë²¤íŠ¸ ìˆ˜ë™ íŠ¸ë¦¬ê±° (ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ ìë™ì±„ì›€)
            supplierSelect.dispatchEvent(new Event('change'));
            break;
        }
    }
  }
  
  // 3. ê²¬ì ì œí’ˆ ì„ íƒ
  if(data.product_category) {
    document.getElementById('product-category').value = data.product_category;
  }
  
  // 4. ì œí’ˆêµìœ¡ (ë“œë¡­ë‹¤ìš´ or í…ìŠ¤íŠ¸)
  if(data.product_training) {
    const trainingSelect = document.getElementById('product-training');
    let matchFound = false;
    for(let i=0; i<trainingSelect.options.length; i++) {
        if(trainingSelect.options[i].value === data.product_training) {
            trainingSelect.selectedIndex = i;
            matchFound = true;
            break;
        }
    }
    
    // ë“œë¡­ë‹¤ìš´ì— ì—†ëŠ” ê°’ì´ë©´ (ì‚¬ìš©ì ì§ì ‘ ì…ë ¥) í…ìŠ¤íŠ¸ í•„ë“œë¡œ ë³€í™˜
    if(!matchFound) {
        const textInput = document.createElement('input');
        textInput.type = 'text';
        textInput.id = 'product-training';
        textInput.value = data.product_training;
        textInput.style.cssText = trainingSelect.style.cssText;
        textInput.style.width = '100%';
        textInput.style.padding = '8px';
        textInput.style.border = '1px solid #ddd';
        textInput.style.borderRadius = '4px';
        
        trainingSelect.parentNode.replaceChild(textInput, trainingSelect);
    }
  }
  
  // 5. ì œí’ˆ ëª©ë¡ ë³µì›
  if (data.products && data.products.length > 0) {
    // ê¸°ì¡´ ì œí’ˆ ì˜ì—­ ì´ˆê¸°í™” (ê¸°ë³¸ ì¶”ê°€ëœ 1ê°œ ì œê±°)
    document.getElementById('products-area').innerHTML = '';
    productCount = 0;
    document.getElementById('add-product').disabled = false;
    
    data.products.forEach((prod, index) => {
      addProductSet(); // ë¹ˆ ì„¸íŠ¸ ì¶”ê°€
      
      // ë°©ê¸ˆ ì¶”ê°€ëœ ì„¸íŠ¸ ì°¾ê¸°
      const sets = document.querySelectorAll('.product-set');
      const set = sets[sets.length - 1];
      
      const majorSelect = set.querySelector('.product-major-category');
      const typeSelect = set.querySelector('.product-type');
      const nameSelect = set.querySelector('.product-name');
      const detailInput = set.querySelector('.product-detail');
      const qtyInput = set.querySelector('.product-qty');
      const priceInput = set.querySelector('.product-price');
      const totalInput = set.querySelector('.product-total');
      const noteInput = set.querySelector('.product-note');
      
      // ëŒ€ë¶„ë¥˜ ì„¤ì •
      majorSelect.value = prod.major_category;
      updateProductTypeOptions(majorSelect, typeSelect);
      
      // êµ¬ë¶„ ì„¤ì • (ì§ì ‘ì…ë ¥ ì²´í¬)
      // productDataì— í•´ë‹¹ êµ¬ë¶„ì´ ìˆìœ¼ë©´ ì¼ë°˜, ì—†ìœ¼ë©´ ì§ì ‘ì…ë ¥ ê°„ì£¼
      const isDirectType = !majorCategories[prod.major_category] || !majorCategories[prod.major_category].includes(prod.type);
      
      if (prod.type === 'ì§ì ‘ì…ë ¥') { // ëª…ì‹œì  'ì§ì ‘ì…ë ¥'
         typeSelect.value = 'ì§ì ‘ì…ë ¥';
         enableDirectInput(typeSelect);
         const typeInput = set.querySelector('.product-type-input');
         if(typeInput) typeInput.value = prod.type; 
      } else {
         // ë“œë¡­ë‹¤ìš´ì— ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
         let typeOptionExists = false;
         for(let i=0; i<typeSelect.options.length; i++){
             if(typeSelect.options[i].value === prod.type) {
                 typeOptionExists = true;
                 break;
             }
         }
         
         if(typeOptionExists) {
             typeSelect.value = prod.type;
             updateProductNameOptions(typeSelect, nameSelect, null);
         } else {
             // ì˜µì…˜ì— ì—†ìœ¼ë©´ ì§ì ‘ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
             const directOpt = document.createElement('option');
             directOpt.value = 'ì§ì ‘ì…ë ¥'; 
             // ìœ„ì—ì„œ createProductSetì‹œ ì´ë¯¸ ì¶”ê°€ë˜ì§€ë§Œ í™•ì‹¤íˆ í•˜ê¸° ìœ„í•´
             typeSelect.value = 'ì§ì ‘ì…ë ¥'; 
             enableDirectInput(typeSelect);
             const typeInput = set.querySelector('.product-type-input');
             if(typeInput) typeInput.value = prod.type;
         }
      }

      // ì œí’ˆëª… ì„¤ì •
      // ì•ì„œ updateProductNameOptionsê°€ í˜¸ì¶œë˜ì—ˆìŒ.
      // ì†Œëª¨í’ˆ ì²˜ë¦¬
      if (prod.type === 'ì†Œëª¨í’ˆ') {
          // ì–´ë–¤ ì†Œëª¨í’ˆ ì¥ë¹„ì¸ì§€ ì°¾ì•„ì•¼ í•¨.
          // prod.nameì´ consumableDataì˜ ì–´ëŠ í‚¤ ë°°ì—´ì— ìˆëŠ”ì§€ ì—­ì¶”ì í•˜ê±°ë‚˜,
          // ì €ì¥ëœ ë°ì´í„°ì— consumableValueê°€ ì—†ìœ¼ë¯€ë¡œ (collectEstimateDataì— ëˆ„ë½ë¨)
          // ì´ë¦„ìœ¼ë¡œ ì¶”ë¡ í•´ì•¼ í•¨.
          
          // í•˜ì§€ë§Œ ì—¬ê¸°ì„  ë‹¨ìˆœíˆ ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ” ì˜µì…˜ì„ ì°¾ê±°ë‚˜ ì—†ìœ¼ë©´ ì§ì ‘ì…ë ¥ ì²˜ë¦¬
          // ì†Œëª¨í’ˆì˜ ê²½ìš° typeSelect ì˜†ì— consumable-optionì´ ìƒê¹€
          const consumableSelect = set.querySelector('.consumable-option');
          if(consumableSelect) {
             // ì†Œëª¨í’ˆ ì¥ë¹„ ëª¨ë¸ì„ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ(ì €ì¥ ì•ˆí•¨), 
             // ëª¨ë“  ì†Œëª¨í’ˆ ë°ì´í„°ë¥¼ ë’¤ì ¸ì„œ ì¼ì¹˜í•˜ëŠ” ì´ë¦„ì´ ìˆëŠ”ì§€ í™•ì¸
             let foundModel = '';
             for(const [model, items] of Object.entries(consumableData)) {
                 if(items.some(item => item.name === prod.name)) {
                     foundModel = model;
                     break;
                 }
             }
             if(foundModel) {
                 consumableSelect.value = foundModel;
                 // ëª¨ë¸ ì„ íƒ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°ì™€ ìœ ì‚¬í•˜ê²Œ ë™ì‘
                 updateProductNameOptions(typeSelect, nameSelect, consumableSelect);
             }
          }
      }
      
      // ì œí’ˆëª… ê°’ ì„¤ì •
      // í˜„ì¬ nameSelectê°€ selectì¸ì§€ inputì¸ì§€ í™•ì¸
      const currentNameEl = set.querySelector('.product-name');
      
      // ë§Œì•½ drop downì— í•´ë‹¹ ì´ë¦„ì´ ì—†ìœ¼ë©´ 'ê¸°íƒ€' -> ì§ì ‘ì…ë ¥ ì „í™˜ ë˜ëŠ” ë°”ë¡œ inputValueì„¤ì •
      if(currentNameEl.tagName === 'SELECT') {
          let nameExists = false;
          for(let i=0; i<currentNameEl.options.length; i++) {
              if(currentNameEl.options[i].value === prod.name) {
                  nameExists = true;
                  break;
              }
          }
          
          if(nameExists) {
              currentNameEl.value = prod.name;
              // ê°€ê²© ì˜µì…˜ ë“± ì—…ë°ì´íŠ¸ (ë‹¨, ì•„ë˜ì—ì„œ ê°’ì„ ë®ì–´ì“¸ ê²ƒì´ë¯€ë¡œ ì¤‘ìš”ë„ëŠ” ë‚®ìŒ)
              // updateProductDetail(...) í˜¸ì¶œí•˜ë©´ detail/priceê°€ ë¦¬ì…‹ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜.
              // ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ ê°’ë§Œ force settingí•˜ê³  detail/priceëŠ” ì €ì¥ëœ ê°’ìœ¼ë¡œ ë®ì–´ì“°ê¸°
          } else {
              // ë¦¬ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ 'ê¸°íƒ€' ì²˜ë¦¬ (ì§ì ‘ì…ë ¥)
              // í˜¹ì€ ì›ë˜ 'ì§ì ‘ì…ë ¥' ëª¨ë“œì˜€ì„ ìˆ˜ ìˆìŒ
              
              // ê°•ì œë¡œ inputìœ¼ë¡œ ë³€í™˜
              const textInput = document.createElement('input');
              textInput.type = 'text';
              textInput.className = 'product-name';
              textInput.style.cssText = currentNameEl.style.cssText;
              textInput.value = prod.name;
              currentNameEl.parentNode.replaceChild(textInput, currentNameEl);
          }
      } else {
          currentNameEl.value = prod.name;
      }
      
      // ìƒì„¸ì •ë³´, ìˆ˜ëŸ‰, ê°€ê²©, ë¹„ê³  ë³µì›
      detailInput.value = prod.detail;
      qtyInput.value = prod.qty;
      priceInput.value = prod.price; // ìˆ«ìí˜•ì´ì–´ë„ inputì—” ì˜ ë“¤ì–´ê°
      totalInput.value = prod.total.toLocaleString(); // ì½¤ë§ˆ í¬ë§·
      noteInput.value = prod.note;
      
      // ê°€ê²© ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬ (ì €ì¥ëœ ê°€ê²©ê³¼ ì¼ì¹˜í•˜ëŠ”ê²Œ ìˆìœ¼ë©´ ìˆ¨ê¹€/ë³´ì„ ì²˜ë¦¬ ë“±)
      // ê·¸ëƒ¥ inputì— ê°’ì„ ë„£ì—ˆìœ¼ë¯€ë¡œ selectëŠ” ìˆ¨ê¹€ ì²˜ë¦¬
      const priceSelect = set.querySelector('.product-price-select');
      if(priceSelect) priceSelect.style.display = 'none';
      priceInput.style.display = 'block';
      
    });
  }
}

// ì œí’ˆêµìœ¡ ë“œë¡­ë‹¤ìš´ ì„ íƒ í›„ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œë¡œ ë³€í™˜
document.addEventListener('DOMContentLoaded', function() {
  const productTrainingSelect = document.getElementById('product-training');
  
  productTrainingSelect.addEventListener('change', function() {
    if (this.value && this.value !== '') {
      // ì„ íƒëœ ê°’ì„ ê°€ì ¸ì˜´
      const selectedValue = this.value;
      
      // ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ìƒì„±
      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.id = 'product-training';
      textInput.value = selectedValue;
      textInput.style.cssText = this.style.cssText; // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë³µì‚¬
      textInput.style.width = '100%';
      textInput.style.padding = '8px';
      textInput.style.border = '1px solid #ddd';
      textInput.style.borderRadius = '4px';
      textInput.placeholder = 'ì œí’ˆêµìœ¡ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì„¸ìš”';
      
      // ë¶€ëª¨ ìš”ì†Œì—ì„œ ë“œë¡­ë‹¤ìš´ ì œê±°í•˜ê³  í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì¶”ê°€
      const parent = this.parentNode;
      parent.removeChild(this);
      parent.appendChild(textInput);
      
      // í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
      textInput.focus();
    }
  });
});

</script>
</body>
</html>
